[{"filePath":"C:\\Users\\User\\.gemini\\antigravity\\playground\\swift-intergalactic\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\User\\.gemini\\antigravity\\playground\\swift-intergalactic\\src\\App.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\User\\.gemini\\antigravity\\playground\\swift-intergalactic\\src\\components\\Layout.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\User\\.gemini\\antigravity\\playground\\swift-intergalactic\\src\\components\\ProtectedRoute.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\User\\.gemini\\antigravity\\playground\\swift-intergalactic\\src\\components\\Sidebar.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'motion' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":4,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":16,"suggestions":[{"messageId":"removeVar","data":{"varName":"motion"},"fix":{"range":[211,218],"text":""},"desc":"Remove unused variable 'motion'."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { NavLink } from 'react-router-dom';\r\nimport { LayoutDashboard, Receipt, FileText, Tags, Menu, X, FileSpreadsheet, Users, LogOut } from 'lucide-react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { useAuth } from '../context/AuthContext';\r\n\r\nexport const Sidebar = () => {\r\n    const { t, i18n } = useTranslation();\r\n    const { userRole, logout } = useAuth();\r\n    const [isOpen, setIsOpen] = useState(false);\r\n\r\n    const toggleLanguage = () => {\r\n        const newLang = i18n.language === 'en' ? 'bg' : 'en';\r\n        i18n.changeLanguage(newLang);\r\n    };\r\n\r\n    const navItems = [\r\n        { name: t('sidebar.dashboard'), path: '/', icon: <LayoutDashboard size={20} /> },\r\n        { name: t('sidebar.transactions'), path: '/transactions', icon: <Receipt size={20} /> },\r\n        { name: t('sidebar.invoices'), path: '/invoices', icon: <FileText size={20} /> },\r\n        { name: t('sidebar.spreadsheet'), path: '/spreadsheet', icon: <FileSpreadsheet size={20} /> },\r\n        { name: t('sidebar.payroll'), path: '/payroll', icon: <Users size={20} /> },\r\n        { name: t('sidebar.categories'), path: '/categories', icon: <Tags size={20} /> },\r\n    ].filter(item => {\r\n        if (userRole === 'manager') return item.path === '/payroll';\r\n        return true;\r\n    });\r\n\r\n    const renderSidebarContent = () => (\r\n        <>\r\n            <div style={{ marginBottom: '3rem', padding: '0 1rem', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\r\n                <h1 className=\"text-gradient\" style={{ fontSize: '1.5rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\r\n                    <div style={{ width: '32px', height: '32px', borderRadius: '8px', background: 'var(--primary)', display: 'grid', placeItems: 'center', color: 'white' }}>\r\n                        ‚Ç¨\r\n                    </div>\r\n                    FinDash\r\n                </h1>\r\n                {/* Mobile Close Button */}\r\n                <button className=\"btn-icon mobile-only\" onClick={() => setIsOpen(false)} style={{ display: typeof window !== 'undefined' && window.innerWidth <= 768 ? 'block' : 'none' }}>\r\n                    <X size={24} />\r\n                </button>\r\n            </div>\r\n\r\n            <nav style={{ flex: 1, display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>\r\n                {navItems.map((item) => (\r\n                    <NavLink\r\n                        key={item.name}\r\n                        to={item.path}\r\n                        onClick={() => setIsOpen(false)}\r\n                        style={({ isActive }) => ({\r\n                            display: 'flex',\r\n                            alignItems: 'center',\r\n                            gap: '1rem',\r\n                            padding: '0.75rem 1rem',\r\n                            borderRadius: 'var(--radius-md)',\r\n                            color: isActive ? 'white' : 'var(--text-secondary)',\r\n                            backgroundColor: isActive ? 'rgba(255, 255, 255, 0.05)' : 'transparent',\r\n                            textDecoration: 'none',\r\n                            fontWeight: 500,\r\n                            transition: 'var(--transition)'\r\n                        })}\r\n                    >\r\n                        {item.icon}\r\n                        {item.name}\r\n                    </NavLink>\r\n                ))}\r\n            </nav>\r\n\r\n            <div style={{ paddingTop: '1.5rem', borderTop: '1px solid var(--panel-border)', marginTop: 'auto', display: 'flex', flexDirection: 'column', gap: '1rem' }}>\r\n                <button\r\n                    className=\"btn btn-outline\"\r\n                    onClick={toggleLanguage}\r\n                    style={{ width: '100%', justifyContent: 'center', borderColor: 'var(--panel-border)', color: 'var(--text-secondary)' }}\r\n                >\r\n                    {i18n.language === 'en' ? 'üáßüá¨ –ë—ä–ª–≥–∞—Ä—Å–∫–∏' : 'üá∫üá∏ English'}\r\n                </button>\r\n                <button onClick={logout} className=\"btn btn-outline\" style={{ width: '100%', justifyContent: 'flex-start', border: 'none', color: 'var(--text-muted)' }}>\r\n                    <LogOut size={20} />\r\n                    {t('sidebar.signOut')}\r\n                </button>\r\n            </div>\r\n        </>\r\n    );\r\n\r\n    return (\r\n        <>\r\n            {/* Mobile Header Toggle */}\r\n            <div className=\"mobile-header\" style={{\r\n                display: 'none', // Overridden in CSS for mobile\r\n                padding: '1rem',\r\n                borderBottom: '1px solid var(--panel-border)',\r\n                background: 'var(--bg-darker)',\r\n                justifyContent: 'space-between',\r\n                alignItems: 'center',\r\n                position: 'sticky',\r\n                top: 0,\r\n                zIndex: 40\r\n            }}>\r\n                <h1 className=\"text-gradient\" style={{ fontSize: '1.25rem', margin: 0 }}>FinDash</h1>\r\n                <button className=\"btn-icon\" onClick={() => setIsOpen(true)}>\r\n                    <Menu size={24} />\r\n                </button>\r\n            </div>\r\n\r\n            {/* Desktop Sidebar */}\r\n            <div className=\"glass-panel desktop-sidebar\" style={{\r\n                width: '260px',\r\n                height: 'calc(100vh - 4rem)',\r\n                margin: '2rem 0 2rem 2rem',\r\n                display: 'flex',\r\n                flexDirection: 'column',\r\n                padding: '1.5rem 1rem',\r\n                position: 'sticky',\r\n                top: '2rem'\r\n            }}>\r\n                {renderSidebarContent()}\r\n            </div>\r\n\r\n            {/* Mobile Sidebar Overlay */}\r\n            <AnimatePresence>\r\n                {isOpen && (\r\n                    <motion.div\r\n                        initial={{ opacity: 0 }}\r\n                        animate={{ opacity: 1 }}\r\n                        exit={{ opacity: 0 }}\r\n                        style={{\r\n                            position: 'fixed', inset: 0, zIndex: 50,\r\n                            background: 'rgba(2, 6, 23, 0.8)', backdropFilter: 'blur(4px)',\r\n                            display: 'flex'\r\n                        }}\r\n                        onClick={() => setIsOpen(false)}\r\n                    >\r\n                        <motion.div\r\n                            initial={{ x: '-100%' }}\r\n                            animate={{ x: 0 }}\r\n                            exit={{ x: '-100%' }}\r\n                            transition={{ type: 'spring', damping: 25, stiffness: 200 }}\r\n                            style={{\r\n                                width: '280px',\r\n                                background: 'var(--panel-bg)',\r\n                                height: '100%',\r\n                                display: 'flex',\r\n                                flexDirection: 'column',\r\n                                padding: '1.5rem 1rem',\r\n                                borderRight: '1px solid var(--panel-border)',\r\n                                boxShadow: 'var(--shadow-panel)'\r\n                            }}\r\n                            onClick={(e) => e.stopPropagation()}\r\n                        >\r\n                            {renderSidebarContent()}\r\n                        </motion.div>\r\n                    </motion.div>\r\n                )}\r\n            </AnimatePresence>\r\n        </>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\User\\.gemini\\antigravity\\playground\\swift-intergalactic\\src\\context\\AuthContext.jsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Move your React context(s) to a separate file.","line":6,"column":14,"nodeType":"Identifier","messageId":"reactContext","endLine":6,"endColumn":25},{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":8,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":8,"endColumn":21}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useEffect, useState } from 'react';\r\nimport { onAuthStateChanged, signInWithEmailAndPassword, signOut } from 'firebase/auth';\r\nimport { doc, getDoc } from 'firebase/firestore';\r\nimport { auth, db } from '../firebase';\r\n\r\nexport const AuthContext = createContext();\r\n\r\nexport const useAuth = () => useContext(AuthContext);\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n    const [currentUser, setCurrentUser] = useState(null);\r\n    const [userRole, setUserRole] = useState(null);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        const unsubscribe = onAuthStateChanged(auth, async (user) => {\r\n            setCurrentUser(user);\r\n            if (user) {\r\n                try {\r\n                    const userDoc = await getDoc(doc(db, 'users', user.uid));\r\n                    if (userDoc.exists()) {\r\n                        setUserRole(userDoc.data().role || 'viewer');\r\n                    } else {\r\n                        setUserRole('viewer');\r\n                    }\r\n                } catch (e) {\r\n                    console.error(\"Error fetching user role:\", e);\r\n                    setUserRole('viewer');\r\n                }\r\n            } else {\r\n                setUserRole(null);\r\n            }\r\n            setLoading(false);\r\n        });\r\n\r\n        return unsubscribe;\r\n    }, []);\r\n\r\n    const login = (email, password) => {\r\n        return signInWithEmailAndPassword(auth, email, password);\r\n    };\r\n\r\n    const logout = () => {\r\n        return signOut(auth);\r\n    };\r\n\r\n    const value = {\r\n        currentUser,\r\n        userRole,\r\n        login,\r\n        logout,\r\n        loading\r\n    };\r\n\r\n    return (\r\n        <AuthContext.Provider value={value}>\r\n            {!loading && children}\r\n        </AuthContext.Provider>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\User\\.gemini\\antigravity\\playground\\swift-intergalactic\\src\\context\\FinanceContext.jsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Move your React context(s) to a separate file.","line":5,"column":14,"nodeType":"Identifier","messageId":"reactContext","endLine":5,"endColumn":28},{"ruleId":"no-unused-vars","severity":2,"message":"'loading' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":39,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":39,"endColumn":19,"suggestions":[{"messageId":"removeVar","data":{"varName":"loading"},"fix":{"range":[2678,2685],"text":""},"desc":"Remove unused variable 'loading'."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'uniqueCategories'. Either include it or remove the dependency array.","line":109,"column":8,"nodeType":"ArrayExpression","endLine":109,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [uniqueCategories]","fix":{"range":[6082,6084],"text":"[uniqueCategories]"}}]},{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":345,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":345,"endColumn":24}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useEffect, useState } from 'react';\r\nimport { collection, query, onSnapshot, addDoc, deleteDoc, doc, setDoc, updateDoc, orderBy, limit } from 'firebase/firestore';\r\nimport { db } from '../firebase';\r\n\r\nexport const FinanceContext = createContext();\r\n\r\nexport const FinanceProvider = ({ children }) => {\r\n    const newCategoriesList = [\r\n        \"–ù–û–©–£–í–ö–ò\", \"–ù–û–©–£–í–ö–ò –ø—Ä–∏—è—Ç–µ–ª–∏, –ø—Ä–µ–∑ –æ—Ñ–∏—Å\", \"–†–ï–°–¢–û–†–ê–ù–¢ –ò–ó–•–†–ê–ù–í–ê–ù–ï\", \"–û–ë–û–†–û–¢ –ë–ê–† –¢–ï–†–ò–¢–û–†–ò–Ø\", \"–§–ò–¢–ù–ï–°\",\r\n        \"–£–ë–û–†–ö–ê –°–û–ë–°–¢–í–ï–ù–ò–¶–ò –î–û–ü–û–õ–ù–ò–¢–ï–ù–û\", \"–°–ß–£–ü–ï–ß–ù–ò, –õ–ò–ü–°–ò, –ù–ê–ï–ú–ò\", \"–ü–ê–†–ö–ò–ù–ì-–ü–†–ò–•–û–î –†–ï–¶–ï–ü–¶–ò–Ø, –ê–ë–û–ù–ê–ú–ï–ù–¢-–†–ê–°–•–û–î\",\r\n        \"–î–†–£–ì–ò –ü–†–ò–•–û–î–ò- –î–†–£–ì–ò –†–ê–°–•–û–î–ò\", \"–ú–ê–†–ù–û –û–û–î\", \"–î–ï–° –ú–ï–ù–ï–î–ú–ï–ù–¢ –∫–æ–º–∏—Å–∏–æ–Ω\", \"BOOKING –∫–æ–º–∏—Å–∏–æ–Ω–∞\",\r\n        \"–†–ï–ö–õ–ê–ú–ê -–ø—Ä–µ–∑ –î–ï–° –ú–ï–ù–ï–î–ñ–ú–™–ù–¢\", \"–†–ï–ö–õ–ê–ú–ê FACEBOOK, GOOGLE\", \"–ö–†–ï–ê–¢–û –ü–†–û–ì–†–ê–ú–ê –†–ï–¶–ï–ü–¶–ò–Ø +(–î–û–ú–ï–ô–ù–ò, –ü–û–©–ò)\",\r\n        \"–î–î–°\", \"–î–û–ü.–§-–†–ò\", \"–¢—É—Ä–µ—Å—Ç–∏—á–µ—Å–∫–∏ –¥–∞–Ω—ä–∫\", \"–î–†–£–ì–ò –î–ê–ù–™–¶–ò\", \"–¢–ê–ö–°–ê –ü–û–°–¢–ï–†–ú–ò–ù–ê–õ\", \"–ë–ê–ù–ö–û–í–ò –¢–ê–ö–°–ò-–ü–†–ï–í–û–î, –ú–ï–°–ï–ß–ù–ò –¢–ê–ö–°–ò\",\r\n        \"–¢–ê–ö–°–ê –°–ß–ï–¢–û–í–û–î–°–¢–í–û\", \"–û–°–ò–ì–£–†–û–í–ö–ò\", \"–î–û–ö–ê–†–ê–ù –ü–ï–†–°–û–ù–ê–õ (–ö–û–ú–ò–°–ò–û–ù, –ü–™–¢–ù–ò –ò –î–û–ö–£–ú–ï–ù–¢–ò)\", \"–ü–™–¢–ù–ò (–ì–†–ê–î–°–ö–ò –¢–†–ê–ù–°–ü–û–†–¢, –¢–ê–ö–°–ò, –ö–ê–†–¢–ò)\",\r\n        \"–û–¢–ü–£–°–ö–ò 2025, 2026\", \"–ë–û–ù–£–°–ò, –ü–û–î–ê–†–™–¶–ò –ó–ê –†–î\", \"–õ–ï–ö–ê–†–ò –ò –ü–†–ï–ì–õ–ï–î–ò –ù–ê –ü–ï–†–°–û–ù–ê–õ+–ú–ï–î.–ö–ù–ò–ñ–ö–ò\", \"–£–ù–ò–§–û–†–ú–ò\",\r\n        \"–¢–û–ö\", \"–í–û–î–ê\", \"–¢–ï–õ–ï–§–û–ù–ò (–ô–ï–¢–¢–ï–õ –ü–û –§-–†–ò)\", \"–ò–ù–¢–ï–†–ù–ï–¢ A1\", \"–ü–û–î–î–†–™–ñ–ö–ê –ö–ò–†–û\", \"–°–û–¢\", \"–ì–ê–ó\", \"–ü–†–ê–ù–ï\", \"–ì–†–ò–í–ù–ò\",\r\n        \"–ï–ö–û–ù–¢, –°–ü–ò–î–ò –ò –î–†–£–ì–ò –î–û–°–¢–ê–í–ö–ò\", \"–ö–ê–ù–¶–ï–õ–Ø–†–°–ö–ò –ú–ê–¢–ï–†–ò–ê–õ–ò, –í–ò–ó–ò–¢–ö–ò, –¢–ê–ë–ï–õ–ò –ò –ü–ï–ß–ê–¢–ò\", \"–•–†–ê–ù–ê –†–ï–°–¢–û–†–ê–ù–¢\",\r\n        \"–ù–ê–ü–ò–¢–ö–ò –†–ï–°–¢–û–†–ê–ù–¢\", \"–ö–û–ù–°–£–ú–ê–¢–ò–í–ò –•–û–¢–ï–õ\",\r\n        \"–¢–ê–ö–°–ò,–ì–õ–û–ë–ò,–õ–ò–¶–ï–ù–ó–ò(–•–ê–°–ò–ü –°–ò–°–¢–ï–ú–ê, –ü–†–û–§–û–ù, –ú–£–ó–ò–ö–ê–£–¢–û–†,–î–û–ö–£–ú–ï–ù–¢–ò, –ö–ê–°–û–í–ò –ê–ü–ê–†–ê–¢–ò, –°–ö–ï–ù–ï–† –†–ï–¶–ï–ü–¶–ò–Ø)\",\r\n        \"–ê–†–û–ú–ê–¢–ò–ó–ê–¢–û–†–ò\", \"–†–ï–ú–û–ù–¢–ò –ò –ü–û–î–î–†–™–ñ–ö–ê –í –†–ï–°–¢–û–†–ê–ù–¢\", \"–ò–ù–í–ï–ù–¢–ê–† –†–ï–°–¢–û–†–ê–ù–¢\", \"–ö–û–ù–°–£–ú–ê–¢–ò–í–ò –†–ï–°–¢–û–†–ê–ù–¢ ( –í–™–ì–õ–ï–©–ê –ò –î–†–£–ì–ò)\",\r\n        \"–†–ï–ú–û–ù–¢–ò –ê–†–ï–ù–î–ù–ò –ê–ü–ê–†–¢–ê–ú–ï–ù–¢–ò\", \"–û–ë–ó–ê–í–ï–ñ–î–ê–ù–ï –ê–†–ï–ù–î–ù–ò –ê–ü–ê–†–¢–ê–ú–ï–ù–¢–ò\", \"–†–ï–ú–û–ù–¢–ò –ü–ï–†–°–û–ù–ê–õ–°–ö–ò –°–¢–ê–ò –ë–û–ù–ê –í–ò–¢–ê\",\r\n        \"–ü–û–î–î–†–™–ñ–ö–ê –°–õ–£–ñ–ï–ë–ù–ò –ù–ê –ö–û–õ–ò (–†–ï–ú–û–ù–¢–ò, –ì–†–ê–ñ–î–ê–°–ù–ö–ò, –ü–†–ï–ì–õ–ï–î–ò)\", \"–ó–ê–î–™–õ–ñ–ï–ù–ò–Ø –û–¢ –ú–ò–ù–ê–õ–ò –ì–û–î–ò–ù–ò !!!!!\",\r\n        \"–ú–ê–†–ù–û –û–û–î –î–™–õ–ì 2024,2025\", \"–ö–ê–†–¢–ò –ü–õ–ê–ñ –†–ï–ë–õ–°\", \"–ü–õ–ê–ñ –†–ï–ë–õ–° –†–ê–°–•–û–î–ò\",\r\n        \"–ó–ê–ü–õ–ê–¢–ê –£–ü–†–ê–í–ò–¢–ï–õ–ò–ò, –û–§–ò–° –ò –í–û–î–ò–¢–ï–õ–¨\", \"–ó–ê–ü–õ–ê–¢–ò –†–ï–¶–ï–ü–¶–ò–Ø\", \"–ó–ê–ü–õ–ê–¢–ò –ö–ê–ú–ï–†–ò–ï–†–ö–ò\",\r\n        \"–ó–ê–ü–õ–ê–¢–ò –ö–£–•–ù–Ø\", \"–ó–ê–ü–õ–ê–¢–ò –°–ï–†–í–ò–¢–¨–û–†–ò,–ß–ï–ö–™–†–ò,–ë–ê–†–ú–ï–ù\", \"–ó–ê–ü–õ–ê–¢–ê –°–ü–ê–°–ò–¢–ï–õ–ò\", \"–ó–ê–ü–õ–ê–¢–ê –ê–ù–ò–ú–ê–¢–û–†–ò\"\r\n    ];\r\n\r\n    // Ensure array values are unique\r\n    const uniqueCategories = [...new Set(newCategoriesList)];\r\n\r\n    const [transactions, setTransactions] = useState([]);\r\n    const [invoices, setInvoices] = useState([]);\r\n    const [employees, setEmployees] = useState([]);\r\n    const [timeLogs, setTimeLogs] = useState([]);\r\n    const [categories, setCategories] = useState({\r\n        income: uniqueCategories,\r\n        expense: uniqueCategories\r\n    });\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    // Sync Data with Firestore\r\n    useEffect(() => {\r\n        // 1. Sync Transactions (Limited to recent to save reads)\r\n        const qTransactions = query(collection(db, 'transactions'), orderBy('date', 'desc'), limit(400));\r\n        const unsubscribeTransactions = onSnapshot(qTransactions, (querySnapshot) => {\r\n            const transArray = [];\r\n            querySnapshot.forEach((doc) => {\r\n                transArray.push({ id: doc.id, ...doc.data() });\r\n            });\r\n            // Sort by date descending\r\n            setTransactions(transArray.sort((a, b) => new Date(b.date) - new Date(a.date)));\r\n        }, (error) => {\r\n            console.error(\"Firestore Error:\", error);\r\n            if (error.message.includes('PERMISSION_DENIED')) {\r\n                alert(\"Database Connection Error: Please ensure Cloud Firestore is enabled in your Firebase Console and the Security Rules allow reads/writes.\");\r\n            }\r\n        });\r\n\r\n        const unsubCategories = onSnapshot(doc(db, 'settings', 'categories'), (docSnap) => {\r\n            const data = docSnap.data();\r\n            // Force update to the new combined Bulgarian list if it doesn't have the new keys yet\r\n            if (docSnap.exists() && data && data.income && data.income.includes(\"–ù–û–©–£–í–ö–ò\")) {\r\n                setCategories(data);\r\n            } else {\r\n                // Overwrite with the new combined list\r\n                setDoc(doc(db, 'settings', 'categories'), { income: uniqueCategories, expense: uniqueCategories });\r\n            }\r\n            setLoading(false);\r\n        });\r\n\r\n        // 3. Sync Invoices (Limited to recent)\r\n        const qInvoices = query(collection(db, 'invoices'), orderBy('dueDate', 'desc'), limit(100));\r\n        const unsubInvoices = onSnapshot(qInvoices, (querySnapshot) => {\r\n            const invoicesArray = [];\r\n            querySnapshot.forEach((doc) => {\r\n                invoicesArray.push({ id: doc.id, ...doc.data() });\r\n            });\r\n            setInvoices(invoicesArray.sort((a, b) => new Date(b.dueDate) - new Date(a.dueDate)));\r\n        });\r\n\r\n        // 4. Sync Employees (Limited to prevent unscalable reads)\r\n        const qEmployees = query(collection(db, 'employees'), limit(300));\r\n        const unsubEmployees = onSnapshot(qEmployees, (querySnapshot) => {\r\n            const employeesArray = [];\r\n            querySnapshot.forEach((doc) => {\r\n                employeesArray.push({ id: doc.id, ...doc.data() });\r\n            });\r\n            setEmployees(employeesArray.sort((a, b) => (a.name || '').localeCompare(b.name || '')));\r\n        });\r\n\r\n        // 5. Sync TimeLogs (Limited to recent months)\r\n        const qTimeLogs = query(collection(db, 'timeLogs'), orderBy('month', 'desc'), limit(300));\r\n        const unsubTimeLogs = onSnapshot(qTimeLogs, (querySnapshot) => {\r\n            const timeLogsArray = [];\r\n            querySnapshot.forEach((doc) => {\r\n                timeLogsArray.push({ id: doc.id, ...doc.data() });\r\n            });\r\n            // Sort by month descending\r\n            setTimeLogs(timeLogsArray.sort((a, b) => (b.month || '').localeCompare(a.month || '')));\r\n        });\r\n\r\n        return () => {\r\n            unsubscribeTransactions();\r\n            unsubCategories();\r\n            unsubInvoices();\r\n            unsubEmployees();\r\n            unsubTimeLogs();\r\n        };\r\n    }, []); // Run once on mount\r\n\r\n    const addTransaction = async (transaction) => {\r\n        try {\r\n            await addDoc(collection(db, 'transactions'), transaction);\r\n        } catch (e) {\r\n            console.error(\"Error adding document: \", e);\r\n            alert(\"Failed to save transaction: \" + e.message);\r\n        }\r\n    };\r\n\r\n    const updateTransaction = async (id, updatedData) => {\r\n        try {\r\n            await updateDoc(doc(db, 'transactions', id), updatedData);\r\n        } catch (e) {\r\n            console.error(\"Error updating transaction: \", e);\r\n            alert(\"Failed to update transaction: \" + e.message);\r\n        }\r\n    };\r\n\r\n    const deleteTransaction = async (id) => {\r\n        try {\r\n            // Find the transaction before deleting to check if it's a payroll transaction\r\n            const txnToDelete = transactions.find(t => t.id === id);\r\n\r\n            if (txnToDelete && txnToDelete.description) {\r\n                const desc = txnToDelete.description.toLowerCase();\r\n\r\n                // Check if it's an advance payment: \"–ê–≤–∞–Ω—Å: [Name] –∑–∞ [Month]\"\r\n                if (desc.includes('–∞–≤–∞–Ω—Å:')) {\r\n                    // Extract name and month. Format is usually \"–ê–≤–∞–Ω—Å: Employee Name –∑–∞ YYYY-MM (–≤ –±—Ä–æ–π)\"\r\n                    const match = txnToDelete.description.match(/–ê–≤–∞–Ω—Å:\\s*(.+?)\\s*–∑–∞\\s*(\\d{4}-\\d{2})/i);\r\n                    if (match) {\r\n                        const empName = match[1].trim();\r\n                        const month = match[2];\r\n                        const emp = employees.find(e => e.name.toLowerCase() === empName.toLowerCase());\r\n\r\n                        if (emp) {\r\n                            const logToUpdate = timeLogs.find(l => l.employeeId === emp.id && l.month === month);\r\n                            if (logToUpdate && logToUpdate.advances) {\r\n                                const deletedAmount = parseFloat(txnToDelete.amount) || 0;\r\n                                // We need to remove the deleted amount from the advances array\r\n                                // Since advances are historically tracked as an array of objects { amount },\r\n                                // we'll find the first advance that matches this amount and remove it,\r\n                                // or adjust the total by creating a negative compensating entry if not exact match.\r\n\r\n                                let newAdvances = [...logToUpdate.advances];\r\n                                const exactMatchIdx = newAdvances.findIndex(a => Math.abs((parseFloat(a.amount) || 0) - deletedAmount) < 0.01);\r\n\r\n                                if (exactMatchIdx !== -1) {\r\n                                    newAdvances.splice(exactMatchIdx, 1);\r\n                                } else {\r\n                                    // Fallback: append a negative advance to balance it out\r\n                                    newAdvances.push({ amount: -deletedAmount, date: new Date().toISOString() });\r\n                                }\r\n\r\n                                await updateDoc(doc(db, 'timeLogs', logToUpdate.id), { advances: newAdvances });\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                // Check if it's a full or remaining salary payment\r\n                else if (desc.includes('–ø—ä–ª–Ω–æ –∏–∑–ø–ª–∞—â–∞–Ω–µ –Ω–∞ –∑–∞–ø–ª–∞—Ç–∞:') || desc.includes('–∏–∑–ø–ª–∞—Ç–µ–Ω –æ—Å—Ç–∞—Ç—ä–∫ –æ—Ç –∑–∞–ø–ª–∞—Ç–∞:')) {\r\n                    const pattern = desc.includes('–ø—ä–ª–Ω–æ')\r\n                        ? /–ü—ä–ª–Ω–æ –∏–∑–ø–ª–∞—â–∞–Ω–µ –Ω–∞ –∑–∞–ø–ª–∞—Ç–∞:\\s*(.+?)\\s*–∑–∞\\s*(\\d{4}-\\d{2})/i\r\n                        : /–ò–∑–ø–ª–∞—Ç–µ–Ω –æ—Å—Ç–∞—Ç—ä–∫ –æ—Ç –∑–∞–ø–ª–∞—Ç–∞:\\s*(.+?)\\s*–∑–∞\\s*(\\d{4}-\\d{2})/i;\r\n\r\n                    const match = txnToDelete.description.match(pattern);\r\n                    if (match) {\r\n                        const empName = match[1].trim();\r\n                        const month = match[2];\r\n                        const emp = employees.find(e => e.name.toLowerCase() === empName.toLowerCase());\r\n\r\n                        if (emp) {\r\n                            const logToUpdate = timeLogs.find(l => l.employeeId === emp.id && l.month === month);\r\n                            if (logToUpdate) {\r\n                                await updateDoc(doc(db, 'timeLogs', logToUpdate.id), { isPaid: false });\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                // Check if it's a refunded advance adjustment\r\n                else if (desc.includes('–≤—ä–∑—Å—Ç–∞–Ω–æ–≤–µ–Ω –∞–≤–∞–Ω—Å:')) {\r\n                    const match = txnToDelete.description.match(/–í—ä–∑—Å—Ç–∞–Ω–æ–≤–µ–Ω –∞–≤–∞–Ω—Å:\\s*(.+)/i);\r\n                    // Without the explicit month in the description, we must assume current month or find the latest log\r\n                    if (match) {\r\n                        const empName = match[1].trim();\r\n                        const emp = employees.find(e => e.name.toLowerCase() === empName.toLowerCase());\r\n\r\n                        if (emp) {\r\n                            // Find the most recent timeLog for this employee since month isn't explicitly in this description\r\n                            const latestLog = timeLogs.filter(l => l.employeeId === emp.id).sort((a, b) => b.month.localeCompare(a.month))[0];\r\n                            if (latestLog) {\r\n                                let newAdvances = [...(latestLog.advances || [])];\r\n                                // We are deleting a \"refund\", so we add the advance BACK to them\r\n                                const amountToAddBack = parseFloat(txnToDelete.amount) || 0;\r\n                                newAdvances.push({ amount: amountToAddBack, date: new Date().toISOString() });\r\n                                await updateDoc(doc(db, 'timeLogs', latestLog.id), { advances: newAdvances });\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            await deleteDoc(doc(db, 'transactions', id));\r\n        } catch (e) {\r\n            console.error(\"Error deleting document: \", e);\r\n        }\r\n    };\r\n\r\n    const addCategory = async (type, name) => {\r\n        if (!categories[type].includes(name)) {\r\n            const newCategories = {\r\n                ...categories,\r\n                [type]: [...categories[type], name]\r\n            };\r\n            await setDoc(doc(db, 'settings', 'categories'), newCategories);\r\n        }\r\n    };\r\n\r\n    const deleteCategory = async (type, name) => {\r\n        const newCategories = {\r\n            ...categories,\r\n            [type]: categories[type].filter(c => c !== name)\r\n        };\r\n        await setDoc(doc(db, 'settings', 'categories'), newCategories);\r\n    };\r\n\r\n    const addInvoice = async (invoice) => {\r\n        try {\r\n            await addDoc(collection(db, 'invoices'), invoice);\r\n        } catch (e) {\r\n            console.error(\"Error adding invoice: \", e);\r\n            alert(\"Failed to save invoice: \" + e.message);\r\n        }\r\n    };\r\n\r\n    const updateInvoice = async (id, updatedData) => {\r\n        try {\r\n            await updateDoc(doc(db, 'invoices', id), updatedData);\r\n        } catch (e) {\r\n            console.error(\"Error updating invoice: \", e);\r\n            alert(\"Failed to update invoice: \" + e.message);\r\n        }\r\n    };\r\n\r\n    const deleteInvoice = async (id) => {\r\n        try {\r\n            await deleteDoc(doc(db, 'invoices', id));\r\n        } catch (e) {\r\n            console.error(\"Error deleting invoice: \", e);\r\n        }\r\n    };\r\n\r\n    // --- Payroll CRUD ---\r\n    const addEmployee = async (employee) => {\r\n        try {\r\n            await addDoc(collection(db, 'employees'), employee);\r\n        } catch (e) {\r\n            console.error(\"Error adding employee: \", e);\r\n            alert(\"Failed to add employee: \" + e.message);\r\n        }\r\n    };\r\n\r\n    const updateEmployee = async (id, updatedData) => {\r\n        try {\r\n            await updateDoc(doc(db, 'employees', id), updatedData);\r\n        } catch (e) {\r\n            console.error(\"Error updating employee: \", e);\r\n        }\r\n    };\r\n\r\n    const deleteEmployee = async (id) => {\r\n        try {\r\n            await deleteDoc(doc(db, 'employees', id));\r\n        } catch (e) {\r\n            console.error(\"Error deleting employee: \", e);\r\n        }\r\n    };\r\n\r\n    const addTimeLog = async (log) => {\r\n        try {\r\n            await addDoc(collection(db, 'timeLogs'), log);\r\n        } catch (e) {\r\n            console.error(\"Error adding time log: \", e);\r\n        }\r\n    };\r\n\r\n    const deleteTimeLog = async (id) => {\r\n        try {\r\n            await deleteDoc(doc(db, 'timeLogs', id));\r\n        } catch (e) {\r\n            console.error(\"Error deleting time log: \", e);\r\n        }\r\n    };\r\n\r\n    // Helper selectors\r\n    const totalIncome = transactions\r\n        .filter(t => t.type === 'income')\r\n        .reduce((sum, t) => sum + parseFloat(t.amount), 0);\r\n\r\n    const totalExpense = transactions\r\n        .filter(t => t.type === 'expense')\r\n        .reduce((sum, t) => sum + parseFloat(t.amount), 0);\r\n\r\n    const netProfit = totalIncome - totalExpense;\r\n\r\n    return (\r\n        <FinanceContext.Provider value={{\r\n            transactions,\r\n            categories,\r\n            invoices,\r\n            employees,\r\n            timeLogs,\r\n            addTransaction,\r\n            updateTransaction,\r\n            deleteTransaction,\r\n            addCategory,\r\n            deleteCategory,\r\n            addInvoice,\r\n            updateInvoice,\r\n            deleteInvoice,\r\n            addEmployee,\r\n            updateEmployee,\r\n            deleteEmployee,\r\n            addTimeLog,\r\n            deleteTimeLog,\r\n            totalIncome,\r\n            totalExpense,\r\n            netProfit\r\n        }}>\r\n            {children}\r\n        </FinanceContext.Provider>\r\n    );\r\n};\r\n\r\nexport const useFinance = () => useContext(FinanceContext);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\User\\.gemini\\antigravity\\playground\\swift-intergalactic\\src\\firebase.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\User\\.gemini\\antigravity\\playground\\swift-intergalactic\\src\\i18n.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\User\\.gemini\\antigravity\\playground\\swift-intergalactic\\src\\main.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\User\\.gemini\\antigravity\\playground\\swift-intergalactic\\src\\pages\\Categories.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'motion' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":5,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":16,"suggestions":[{"messageId":"removeVar","data":{"varName":"motion"},"fix":{"range":[210,217],"text":""},"desc":"Remove unused variable 'motion'."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { useFinance } from '../context/FinanceContext';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { Plus, Trash2, Tag } from 'lucide-react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nexport const Categories = () => {\r\n    const { categories, addCategory, deleteCategory } = useFinance();\r\n    const { userRole } = useAuth();\r\n    const { t } = useTranslation();\r\n    const [newExpenseCat, setNewExpenseCat] = useState('');\r\n    const [newIncomeCat, setNewIncomeCat] = useState('');\r\n\r\n    const translateCategory = (cat) => t('categoryNames', { returnObjects: true })[cat] || cat;\r\n\r\n    const handleAddCategory = (e, type) => {\r\n        e.preventDefault();\r\n        if (type === 'expense' && newExpenseCat.trim()) {\r\n            addCategory('expense', newExpenseCat.trim());\r\n            setNewExpenseCat('');\r\n        } else if (type === 'income' && newIncomeCat.trim()) {\r\n            addCategory('income', newIncomeCat.trim());\r\n            setNewIncomeCat('');\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"animate-fade-in\">\r\n            <div className=\"page-header\">\r\n                <div>\r\n                    <h1 className=\"page-title\">{t('categories.title')}</h1>\r\n                    <p className=\"page-subtitle\">{t('categories.subtitle')}</p>\r\n                </div>\r\n            </div>\r\n\r\n            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(280px, 1fr))', gap: '2rem' }}>\r\n\r\n                {/* Income Categories */}\r\n                <div className=\"glass-panel\" style={{ padding: '2rem' }}>\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem', marginBottom: '1.5rem' }}>\r\n                        <div style={{ padding: '0.5rem', background: 'var(--success-bg)', color: 'var(--success)', borderRadius: 'var(--radius-sm)' }}>\r\n                            <Tag size={20} />\r\n                        </div>\r\n                        <h2 style={{ fontSize: '1.25rem' }}>{t('categories.incomeCategories')}</h2>\r\n                    </div>\r\n\r\n                    {userRole !== 'viewer' && (\r\n                        <form onSubmit={(e) => handleAddCategory(e, 'income')} style={{ display: 'flex', gap: '1rem', marginBottom: '2rem' }}>\r\n                            <div className=\"input-group\" style={{ flex: 1, marginBottom: 0 }}>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    placeholder={t('categories.addIncome')}\r\n                                    value={newIncomeCat}\r\n                                    onChange={(e) => setNewIncomeCat(e.target.value)}\r\n                                    required\r\n                                />\r\n                            </div>\r\n                            <button type=\"submit\" className=\"btn btn-primary\" style={{ padding: '0.75rem', height: 'fit-content' }}>\r\n                                <Plus size={20} />\r\n                            </button>\r\n                        </form>\r\n                    )}\r\n\r\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '0.75rem' }}>\r\n                        <AnimatePresence>\r\n                            {categories.income.map(cat => (\r\n                                <motion.div\r\n                                    initial={{ opacity: 0, x: -20 }}\r\n                                    animate={{ opacity: 1, x: 0 }}\r\n                                    exit={{ opacity: 0, x: 20 }}\r\n                                    key={cat}\r\n                                    style={{\r\n                                        display: 'flex', justifyContent: 'space-between', alignItems: 'center',\r\n                                        padding: '1rem', background: 'rgba(255,255,255,0.02)', borderRadius: 'var(--radius-sm)',\r\n                                        border: '1px solid var(--panel-border)'\r\n                                    }}\r\n                                >\r\n                                    <span style={{ fontWeight: 500 }}>\r\n                                        {translateCategory(cat)}\r\n                                    </span>\r\n                                    {userRole !== 'viewer' && (\r\n                                        <button className=\"btn-icon\" onClick={() => deleteCategory('income', cat)} title={`Delete ${cat}`}>\r\n                                            <Trash2 size={16} />\r\n                                        </button>\r\n                                    )}\r\n                                </motion.div>\r\n                            ))}\r\n                        </AnimatePresence>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Expense Categories */}\r\n                <div className=\"glass-panel\" style={{ padding: '2rem' }}>\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem', marginBottom: '1.5rem' }}>\r\n                        <div style={{ padding: '0.5rem', background: 'var(--danger-bg)', color: 'var(--danger)', borderRadius: 'var(--radius-sm)' }}>\r\n                            <Tag size={20} />\r\n                        </div>\r\n                        <h2 style={{ fontSize: '1.25rem' }}>{t('categories.expenseCategories')}</h2>\r\n                    </div>\r\n\r\n                    {userRole !== 'viewer' && (\r\n                        <form onSubmit={(e) => handleAddCategory(e, 'expense')} style={{ display: 'flex', gap: '1rem', marginBottom: '2rem' }}>\r\n                            <div className=\"input-group\" style={{ flex: 1, marginBottom: 0 }}>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    placeholder={t('categories.addExpense')}\r\n                                    value={newExpenseCat}\r\n                                    onChange={(e) => setNewExpenseCat(e.target.value)}\r\n                                    required\r\n                                />\r\n                            </div>\r\n                            <button type=\"submit\" className=\"btn\" style={{ background: 'var(--danger)', color: 'white', padding: '0.75rem', height: 'fit-content' }}>\r\n                                <Plus size={20} />\r\n                            </button>\r\n                        </form>\r\n                    )}\r\n\r\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '0.75rem' }}>\r\n                        <AnimatePresence>\r\n                            {categories.expense.map(cat => (\r\n                                <motion.div\r\n                                    initial={{ opacity: 0, x: -20 }}\r\n                                    animate={{ opacity: 1, x: 0 }}\r\n                                    exit={{ opacity: 0, x: 20 }}\r\n                                    key={cat}\r\n                                    style={{\r\n                                        display: 'flex', justifyContent: 'space-between', alignItems: 'center',\r\n                                        padding: '1rem', background: 'rgba(255,255,255,0.02)', borderRadius: 'var(--radius-sm)',\r\n                                        border: '1px solid var(--panel-border)'\r\n                                    }}\r\n                                >\r\n                                    <span style={{ fontWeight: 500 }}>\r\n                                        {translateCategory(cat)}\r\n                                    </span>\r\n                                    {userRole !== 'viewer' && (\r\n                                        <button className=\"btn-icon\" onClick={() => deleteCategory('expense', cat)} title={`Delete ${cat}`}>\r\n                                            <Trash2 size={16} />\r\n                                        </button>\r\n                                    )}\r\n                                </motion.div>\r\n                            ))}\r\n                        </AnimatePresence>\r\n                    </div>\r\n                </div>\r\n\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\User\\.gemini\\antigravity\\playground\\swift-intergalactic\\src\\pages\\Dashboard.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\User\\.gemini\\antigravity\\playground\\swift-intergalactic\\src\\pages\\Invoices.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'motion' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":5,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":16,"suggestions":[{"messageId":"removeVar","data":{"varName":"motion"},"fix":{"range":[238,245],"text":""},"desc":"Remove unused variable 'motion'."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\:.","line":62,"column":126,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":62,"endColumn":127,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2916,2917],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2916,2916],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\..","line":62,"column":151,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":62,"endColumn":152,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2941,2942],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2941,2941],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\,.","line":62,"column":153,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":62,"endColumn":154,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2943,2944],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2943,2943],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\..","line":67,"column":66,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":67,"endColumn":67,"suggestions":[{"messageId":"removeEscape","fix":{"range":[3306,3307],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[3306,3306],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\,.","line":67,"column":68,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":67,"endColumn":69,"suggestions":[{"messageId":"removeEscape","fix":{"range":[3308,3309],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[3308,3308],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\..","line":78,"column":116,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":78,"endColumn":117,"suggestions":[{"messageId":"removeEscape","fix":{"range":[3945,3946],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[3945,3945],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\,.","line":78,"column":118,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":78,"endColumn":119,"suggestions":[{"messageId":"removeEscape","fix":{"range":[3947,3948],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[3947,3947],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":78,"column":122,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":78,"endColumn":123,"suggestions":[{"messageId":"removeEscape","fix":{"range":[3951,3952],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[3951,3951],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":78,"column":124,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":78,"endColumn":125,"suggestions":[{"messageId":"removeEscape","fix":{"range":[3953,3954],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[3953,3953],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\:.","line":85,"column":59,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":85,"endColumn":60,"suggestions":[{"messageId":"removeEscape","fix":{"range":[4409,4410],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[4409,4409],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\..","line":85,"column":61,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":85,"endColumn":62,"suggestions":[{"messageId":"removeEscape","fix":{"range":[4411,4412],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[4411,4411],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":85,"column":73,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":85,"endColumn":74,"suggestions":[{"messageId":"removeEscape","fix":{"range":[4423,4424],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[4423,4423],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\..","line":85,"column":77,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":85,"endColumn":78,"suggestions":[{"messageId":"removeEscape","fix":{"range":[4427,4428],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[4427,4427],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":85,"column":89,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":85,"endColumn":90,"suggestions":[{"messageId":"removeEscape","fix":{"range":[4439,4440],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[4439,4439],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\..","line":85,"column":93,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":85,"endColumn":94,"suggestions":[{"messageId":"removeEscape","fix":{"range":[4443,4444],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[4443,4443],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":85,"column":131,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":85,"endColumn":132,"suggestions":[{"messageId":"removeEscape","fix":{"range":[4481,4482],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[4481,4481],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\..","line":85,"column":135,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":85,"endColumn":136,"suggestions":[{"messageId":"removeEscape","fix":{"range":[4485,4486],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[4485,4485],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":85,"column":146,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":85,"endColumn":147,"suggestions":[{"messageId":"removeEscape","fix":{"range":[4496,4497],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[4496,4496],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\..","line":85,"column":150,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":85,"endColumn":151,"suggestions":[{"messageId":"removeEscape","fix":{"range":[4500,4501],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[4500,4500],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]}],"suppressedMessages":[],"errorCount":20,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { useFinance } from '../context/FinanceContext';\r\nimport { Plus, Search, Trash2, DollarSign, Camera, Edit2 } from 'lucide-react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport Tesseract from 'tesseract.js';\r\nimport { useAuth } from '../context/AuthContext';\r\n\r\nconst formatCurrency = (amount) => {\r\n    return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'EUR' }).format(amount);\r\n};\r\n\r\nexport const Invoices = () => {\r\n    const { invoices, addInvoice, updateInvoice, deleteInvoice, addTransaction, transactions, updateTransaction, deleteTransaction } = useFinance();\r\n    const { userRole } = useAuth();\r\n    const { t } = useTranslation();\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [isCreateModalOpen, setIsCreateModalOpen] = useState(false);\r\n    const [isPaymentModalOpen, setIsPaymentModalOpen] = useState(false);\r\n    const [selectedInvoice, setSelectedInvoice] = useState(null);\r\n    const [isScanning, setIsScanning] = useState(false);\r\n    const [scanProgress, setScanProgress] = useState('');\r\n\r\n    // Create/Edit Invoice State\r\n    const [editingInvoiceId, setEditingInvoiceId] = useState(null);\r\n    const [clientName, setClientName] = useState('');\r\n    const [totalAmount, setTotalAmount] = useState('');\r\n    const [paidAmount, setPaidAmount] = useState('');\r\n    const [dueDate, setDueDate] = useState(new Date().toISOString().split('T')[0]);\r\n    const [description, setDescription] = useState('');\r\n\r\n    // Payment State\r\n    const [paymentAmount, setPaymentAmount] = useState('');\r\n    const [paymentMethod, setPaymentMethod] = useState('bank'); // Default to bank for invoices\r\n\r\n    const filteredInvoices = invoices.filter(inv => {\r\n        return inv.clientName.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n            (inv.description && inv.description.toLowerCase().includes(searchTerm.toLowerCase()));\r\n    });\r\n\r\n    const handleScan = async (e) => {\r\n        const file = e.target.files[0];\r\n        if (!file) return;\r\n\r\n        setIsScanning(true);\r\n        setScanProgress(t('invoices.scanProgress'));\r\n\r\n        let worker = null;\r\n        try {\r\n            worker = await Tesseract.createWorker('bul+eng');\r\n            await worker.setParameters({\r\n                tessedit_pageseg_mode: Tesseract.PSM.SPARSE_TEXT,\r\n            });\r\n\r\n            const result = await worker.recognize(file);\r\n            const text = result.data.text;\r\n            console.log(\"OCR Result Text:\\n\", text);\r\n\r\n            // Basic parsing logic\r\n            // 1. Total Amount: Try strict match, then fallback to finding the highest reasonable currency number\r\n            let extractedAmount = null;\r\n            const amountStrMatch = text.match(/(?:–æ–±—â–∞ —Å—É–º–∞|—Å—É–º–∞ –∑–∞ –ø–ª–∞—â–∞–Ω–µ|—Å—É–º–∞|total|–ø–ª–∞—â–∞–Ω–µ|—Å—Ç–æ–π–Ω–æ—Å—Ç|–≤—Å–∏—á–∫–æ|–¥–¥—Å|–æ—Å–Ω–æ–≤–∞)[\\s\\:A-Za-z–ê-–Ø–∞-—è]*([\\d\\s]+[\\.\\,]\\d{2})/i);\r\n            if (amountStrMatch && amountStrMatch[1]) {\r\n                extractedAmount = parseFloat(amountStrMatch[1].replace(/\\s/g, '').replace(',', '.'));\r\n            } else {\r\n                // Fallback: Find all 0.00 or 0,00 formatted numbers in the text and get the maximum\r\n                const allNumbers = [...text.matchAll(/\\b(\\d{1,6}[\\.\\,]\\d{2})\\b/g)];\r\n                if (allNumbers.length > 0) {\r\n                    const parsedNums = allNumbers.map(m => parseFloat(m[1].replace(',', '.'))).filter(n => !isNaN(n));\r\n                    if (parsedNums.length > 0) extractedAmount = Math.max(...parsedNums);\r\n                }\r\n            }\r\n            if (extractedAmount && !isNaN(extractedAmount)) {\r\n                setTotalAmount(extractedAmount.toFixed(2));\r\n            }\r\n\r\n            // 2. Client Name: Look for common buyer/receiver prefixes\r\n            const clientMatch = text.match(/(?:–ø–æ–ª—É—á–∞—Ç–µ–ª|–∫–ª–∏–µ–Ω—Ç|–ø–æ–ª—É—á–∞—Ç–µ–ª:|–∫–ª–∏–µ–Ω—Ç:|–∫—É–ø—É–≤–∞—á)[\\s]+([A-Za-z–ê-–Ø–∞-—è0-9\\s\\.\\,\\-\\\"\\']+)/i) || text.match(/([–ê-–Ø][–ê-–Ø–∞-—è]+(?:\\s[–ê-–Ø–∞-—è]+)?\\s+(?:–û–û–î|–ï–û–û–î|–ê–î|–ï–ê–î|–ï–¢))/i);\r\n            if (clientMatch && clientMatch[1]) {\r\n                const cleanedClient = clientMatch[1].replace(/(?:–ï–ò–ö|–î–î–°|BG\\d+|–≥—Ä\\.|—É–ª\\.).*/i, '').trim();\r\n                setClientName(cleanedClient.substring(0, 50));\r\n            }\r\n\r\n            // 3. Date (DD-MM-YYYY or DD.MM.YYYY even if missing dots)\r\n            const dateMatch = text.match(/(?:–¥–∞—Ç–∞|date)[\\s\\:\\.]*(\\d{2})[\\/\\-\\.]?(\\d{2})[\\/\\-\\.]?(\\d{4})/i) || text.match(/(\\d{2})[\\/\\-\\.](\\d{2})[\\/\\-\\.](\\d{2,4})/);\r\n            if (dateMatch) {\r\n                const year = dateMatch[3].length === 2 ? `20${dateMatch[3]}` : dateMatch[3];\r\n                setDueDate(`${year}-${dateMatch[2]}-${dateMatch[1]}`);\r\n            }\r\n\r\n            // Open Modal with prefilled values\r\n            setIsCreateModalOpen(true);\r\n        } catch (error) {\r\n            console.error(\"OCR Error:\", error);\r\n            const errMsg = error?.message || (typeof error === 'string' ? error : JSON.stringify(error));\r\n            alert(t('invoices.scanError') + \" \" + errMsg);\r\n        } finally {\r\n            if (worker) {\r\n                await worker.terminate().catch(console.error);\r\n            }\r\n            setIsScanning(false);\r\n            setScanProgress('');\r\n            e.target.value = null;\r\n        }\r\n    };\r\n\r\n    const handleAddInvoice = (e) => {\r\n        e.preventDefault();\r\n        if (!clientName || !totalAmount) return;\r\n\r\n        const payload = {\r\n            clientName,\r\n            totalAmount: parseFloat(totalAmount),\r\n            dueDate,\r\n            description\r\n        };\r\n\r\n        if (editingInvoiceId) {\r\n            const oldPaid = invoices.find(i => i.id === editingInvoiceId)?.paidAmount || 0;\r\n            payload.paidAmount = paidAmount !== '' ? parseFloat(paidAmount) : 0;\r\n            const diff = parseFloat((payload.paidAmount - oldPaid).toFixed(2));\r\n\r\n            if (diff !== 0) {\r\n                const relatedTxns = transactions.filter(t => t.type === 'income' && (t.description || '').toLowerCase().includes(clientName.toLowerCase())).sort((a, b) => new Date(b.date) - new Date(a.date));\r\n                let remainingDiff = diff;\r\n\r\n                if (remainingDiff < 0) {\r\n                    let toRemove = Math.abs(remainingDiff);\r\n                    for (let txn of relatedTxns) {\r\n                        if (toRemove <= 0) break;\r\n                        const txnAmt = parseFloat(txn.amount) || 0;\r\n                        if (txnAmt <= toRemove) {\r\n                            deleteTransaction(txn.id);\r\n                            toRemove = parseFloat((toRemove - txnAmt).toFixed(2));\r\n                        } else {\r\n                            updateTransaction(txn.id, { amount: (txnAmt - toRemove).toFixed(2) });\r\n                            toRemove = 0;\r\n                        }\r\n                    }\r\n                    if (toRemove > 0) {\r\n                        addTransaction({\r\n                            type: 'expense',\r\n                            amount: toRemove.toFixed(2),\r\n                            category: '–ö–æ—Ä–µ–∫—Ü–∏—è',\r\n                            date: new Date().toISOString().split('T')[0],\r\n                            description: `–ö–æ—Ä–µ–∫—Ü–∏—è (–Ω–∞–º–∞–ª–µ–Ω–æ –ø–ª–∞—â–∞–Ω–µ): ${clientName}`,\r\n                            paymentMethod: 'cash'\r\n                        });\r\n                    }\r\n                } else {\r\n                    addTransaction({\r\n                        type: 'income',\r\n                        amount: remainingDiff.toFixed(2),\r\n                        category: '–ü–ª–∞—â–∞–Ω–∏—è',\r\n                        date: new Date().toISOString().split('T')[0],\r\n                        description: `${t('invoices.paymentFor')} ${clientName}`,\r\n                        paymentMethod: 'cash'\r\n                    });\r\n                }\r\n            }\r\n\r\n            updateInvoice(editingInvoiceId, payload);\r\n        } else {\r\n            payload.paidAmount = 0;\r\n            payload.createdAt = new Date().toISOString();\r\n            addInvoice(payload);\r\n        }\r\n\r\n        setIsCreateModalOpen(false);\r\n        setEditingInvoiceId(null);\r\n        setClientName('');\r\n        setTotalAmount('');\r\n        setPaidAmount('');\r\n        setDescription('');\r\n        setDueDate(new Date().toISOString().split('T')[0]);\r\n    };\r\n\r\n    const handleOpenEditModal = (inv) => {\r\n        setEditingInvoiceId(inv.id);\r\n        setClientName(inv.clientName);\r\n        setTotalAmount(inv.totalAmount.toString());\r\n        setPaidAmount((inv.paidAmount || 0).toString());\r\n        setDueDate(inv.dueDate || new Date().toISOString().split('T')[0]);\r\n        setDescription(inv.description || '');\r\n        setIsCreateModalOpen(true);\r\n    };\r\n\r\n    const handleOpenCreateModal = () => {\r\n        setEditingInvoiceId(null);\r\n        setClientName('');\r\n        setTotalAmount('');\r\n        setPaidAmount('');\r\n        setDueDate(new Date().toISOString().split('T')[0]);\r\n        setDescription('');\r\n        setIsCreateModalOpen(true);\r\n    };\r\n\r\n    const handleOpenPaymentModal = (invoice) => {\r\n        setSelectedInvoice(invoice);\r\n        setPaymentAmount((invoice.totalAmount - (invoice.paidAmount || 0)).toString());\r\n        setIsPaymentModalOpen(true);\r\n    };\r\n\r\n    const handleAddPayment = (e) => {\r\n        e.preventDefault();\r\n        if (!paymentAmount || parseFloat(paymentAmount) <= 0 || !selectedInvoice) return;\r\n\r\n        const amountToPay = parseFloat(paymentAmount);\r\n\r\n        // 1. Update the Invoice\r\n        const newPaidAmount = (selectedInvoice.paidAmount || 0) + amountToPay;\r\n        updateInvoice(selectedInvoice.id, {\r\n            paidAmount: newPaidAmount\r\n        });\r\n\r\n        // 2. Create a corresponding generic Income transaction\r\n        addTransaction({\r\n            type: 'income',\r\n            amount: amountToPay,\r\n            category: 'Other', // Generic category to ensure it's logged\r\n            date: new Date().toISOString().split('T')[0],\r\n            description: `${t('invoices.paymentFor')} ${selectedInvoice.clientName}`,\r\n            paymentMethod: paymentMethod\r\n        });\r\n\r\n        setIsPaymentModalOpen(false);\r\n        setSelectedInvoice(null);\r\n        setPaymentAmount('');\r\n    };\r\n\r\n    const getStatusText = (invoice) => {\r\n        const paid = invoice.paidAmount || 0;\r\n        const total = invoice.totalAmount || 0;\r\n        if (paid === 0) return t('invoices.statusUnpaid');\r\n        if (paid >= total) return t('invoices.statusPaid');\r\n        return t('invoices.statusPartial');\r\n    };\r\n\r\n    const getStatusColor = (invoice) => {\r\n        const paid = invoice.paidAmount || 0;\r\n        const total = invoice.totalAmount || 0;\r\n        if (paid === 0) return 'var(--danger)';\r\n        if (paid >= total) return 'var(--success)';\r\n        return 'var(--warning)';\r\n    };\r\n\r\n    return (\r\n        <div style={{ maxWidth: '1200px', margin: '0 auto' }}>\r\n            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '2rem' }}>\r\n                <div>\r\n                    <h1 className=\"text-gradient\" style={{ fontSize: '2.5rem', marginBottom: '0.5rem' }}>{t('invoices.title')}</h1>\r\n                    <p style={{ color: 'var(--text-secondary)' }}>{t('invoices.subtitle')}</p>\r\n                </div>\r\n                {userRole !== 'viewer' && (\r\n                    <div style={{ display: 'flex', gap: '1rem', alignItems: 'center' }}>\r\n                        <div>\r\n                            <input\r\n                                type=\"file\"\r\n                                accept=\"image/*, application/pdf\"\r\n                                capture=\"environment\"\r\n                                style={{ display: 'none' }}\r\n                                id=\"scan-invoice-upload\"\r\n                                onChange={handleScan}\r\n                                disabled={isScanning}\r\n                            />\r\n                            <label\r\n                                htmlFor=\"scan-invoice-upload\"\r\n                                className=\"btn\"\r\n                                style={{\r\n                                    background: 'var(--bg-lighter)',\r\n                                    color: 'var(--text-primary)',\r\n                                    border: '1px solid var(--panel-border)',\r\n                                    cursor: isScanning ? 'not-allowed' : 'pointer',\r\n                                    display: 'flex',\r\n                                    alignItems: 'center',\r\n                                    gap: '0.5rem',\r\n                                    padding: '0.75rem 1.25rem',\r\n                                    borderRadius: 'var(--radius-md)',\r\n                                    fontWeight: 500,\r\n                                    opacity: isScanning ? 0.7 : 1\r\n                                }}\r\n                            >\r\n                                {isScanning ? (\r\n                                    <div style={{ width: '20px', height: '20px', border: '2px solid rgba(255,255,255,0.1)', borderTopColor: 'var(--text-primary)', borderRadius: '50%', animation: 'spin 1s linear infinite' }} />\r\n                                ) : (\r\n                                    <Camera size={20} />\r\n                                )}\r\n                                {isScanning ? scanProgress : t('invoices.scanInvoice')}\r\n                            </label>\r\n                        </div>\r\n                        <button className=\"btn btn-primary\" onClick={handleOpenCreateModal}>\r\n                            <Plus size={20} />\r\n                            {t('invoices.addInvoice')}\r\n                        </button>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            <div className=\"glass-panel\" style={{ padding: '1.5rem', marginBottom: '2rem' }}>\r\n                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '1rem', marginBottom: '1rem' }}>\r\n                    <div style={{ position: 'relative', flex: '1 1 300px', display: 'flex', alignItems: 'center', background: 'var(--bg-dark)', border: '1px solid var(--panel-border)', borderRadius: 'var(--radius-sm)', transition: 'var(--transition)' }}>\r\n                        <Search size={18} style={{ position: 'absolute', left: '1rem', color: 'var(--text-muted)' }} />\r\n                        <input\r\n                            type=\"text\"\r\n                            placeholder={t('invoices.search')}\r\n                            value={searchTerm}\r\n                            onChange={(e) => setSearchTerm(e.target.value)}\r\n                            style={{\r\n                                width: '100%',\r\n                                padding: '0.75rem 1rem 0.75rem 2.5rem',\r\n                                background: 'transparent',\r\n                                border: 'none',\r\n                                color: 'var(--text-primary)',\r\n                                outline: 'none',\r\n                                fontSize: '0.95rem'\r\n                            }}\r\n                        />\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"table-container\" style={{ overflowX: 'auto' }}>\r\n                    <table style={{ width: '100%', borderCollapse: 'collapse', textAlign: 'left' }}>\r\n                        <thead>\r\n                            <tr style={{ borderBottom: '1px solid var(--panel-border)' }}>\r\n                                <th style={{ padding: '1rem', color: 'var(--text-secondary)', fontWeight: 500 }}>{t('invoices.colClient')}</th>\r\n                                <th style={{ padding: '1rem', color: 'var(--text-secondary)', fontWeight: 500 }}>{t('invoices.colTotal')}</th>\r\n                                <th style={{ padding: '1rem', color: 'var(--text-secondary)', fontWeight: 500 }}>{t('invoices.colPaid')}</th>\r\n                                <th style={{ padding: '1rem', color: 'var(--text-secondary)', fontWeight: 500 }}>{t('invoices.colDue')}</th>\r\n                                <th style={{ padding: '1rem', color: 'var(--text-secondary)', fontWeight: 500 }}>{t('invoices.colStatus')}</th>\r\n                                {userRole !== 'viewer' && <th style={{ padding: '1rem', color: 'var(--text-secondary)', fontWeight: 500, textAlign: 'right' }}>{t('invoices.colActions')}</th>}\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                            <AnimatePresence>\r\n                                {filteredInvoices.map((inv) => (\r\n                                    <motion.tr\r\n                                        key={inv.id}\r\n                                        initial={{ opacity: 0, y: -10 }}\r\n                                        animate={{ opacity: 1, y: 0 }}\r\n                                        exit={{ opacity: 0, height: 0 }}\r\n                                        style={{ borderBottom: '1px solid var(--panel-border)' }}\r\n                                    >\r\n                                        <td style={{ padding: '1rem' }}>\r\n                                            <div style={{ fontWeight: 500, color: 'var(--text-primary)' }}>{inv.clientName}</div>\r\n                                            {inv.description && <div style={{ fontSize: '0.875rem', color: 'var(--text-muted)' }}>{inv.description}</div>}\r\n                                        </td>\r\n                                        <td style={{ padding: '1rem', fontWeight: 600 }}>{formatCurrency(inv.totalAmount)}</td>\r\n                                        <td style={{ padding: '1rem', color: 'var(--success)' }}>{formatCurrency(inv.paidAmount || 0)}</td>\r\n                                        <td style={{ padding: '1rem', color: 'var(--text-secondary)' }}>{inv.dueDate}</td>\r\n                                        <td style={{ padding: '1rem' }}>\r\n                                            <span style={{\r\n                                                padding: '0.25rem 0.75rem',\r\n                                                borderRadius: '2rem',\r\n                                                fontSize: '0.85rem',\r\n                                                fontWeight: 500,\r\n                                                background: `${getStatusColor(inv)}20`,\r\n                                                color: getStatusColor(inv)\r\n                                            }}>\r\n                                                {getStatusText(inv)}\r\n                                            </span>\r\n                                        </td>\r\n                                        {userRole !== 'viewer' && (\r\n                                            <td style={{ padding: '1rem', textAlign: 'right' }}>\r\n                                                <div style={{ display: 'flex', gap: '0.5rem', justifyContent: 'flex-end' }}>\r\n                                                    {parseFloat(inv.paidAmount || 0) < parseFloat(inv.totalAmount || 0) && (\r\n                                                        <button\r\n                                                            onClick={() => handleOpenPaymentModal(inv)}\r\n                                                            className=\"btn-icon\"\r\n                                                            style={{ color: 'var(--success)' }}\r\n                                                            title={t('invoices.addPayment')}\r\n                                                        >\r\n                                                            <DollarSign size={18} />\r\n                                                        </button>\r\n                                                    )}\r\n                                                    <button\r\n                                                        onClick={() => handleOpenEditModal(inv)}\r\n                                                        className=\"btn-icon\"\r\n                                                        title=\"–†–µ–¥–∞–∫—Ç–∏—Ä–∞–Ω–µ\"\r\n                                                    >\r\n                                                        <Edit2 size={18} />\r\n                                                    </button>\r\n                                                    <button\r\n                                                        onClick={() => deleteInvoice(inv.id)}\r\n                                                        className=\"btn-icon text-danger\"\r\n                                                    >\r\n                                                        <Trash2 size={18} />\r\n                                                    </button>\r\n                                                </div>\r\n                                            </td>\r\n                                        )}\r\n                                    </motion.tr>\r\n                                ))}\r\n                            </AnimatePresence>\r\n                        </tbody>\r\n                    </table>\r\n                    {filteredInvoices.length === 0 && (\r\n                        <div style={{ padding: '3rem', textAlign: 'center', color: 'var(--text-muted)' }}>\r\n                            {t('transactions.noTransactions')} {/* Reusing translation for now */}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Create Invoice Modal */}\r\n            <AnimatePresence>\r\n                {isCreateModalOpen && (\r\n                    <div className=\"modal-overlay\" onClick={() => setIsCreateModalOpen(false)}>\r\n                        <motion.div\r\n                            initial={{ scale: 0.95, opacity: 0 }}\r\n                            animate={{ scale: 1, opacity: 1 }}\r\n                            exit={{ scale: 0.95, opacity: 0 }}\r\n                            className=\"glass-panel\"\r\n                            style={{ padding: '2rem', width: '100%', maxWidth: '500px' }}\r\n                            onClick={e => e.stopPropagation()}\r\n                        >\r\n                            <h2 style={{ marginBottom: '1.5rem', color: 'var(--text-primary)' }}>\r\n                                {editingInvoiceId ? '–†–µ–¥–∞–∫—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –§–∞–∫—Ç—É—Ä–∞' : t('invoices.addInvoice')}\r\n                            </h2>\r\n                            <form onSubmit={handleAddInvoice} style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>\r\n\r\n                                <div className=\"input-group\">\r\n                                    <label>{t('invoices.colClient')} *</label>\r\n                                    <input type=\"text\" required value={clientName} onChange={(e) => setClientName(e.target.value)} className=\"filter-input\" />\r\n                                </div>\r\n\r\n                                <div className=\"input-group\">\r\n                                    <label>{t('invoices.colTotal')} *</label>\r\n                                    <div style={{ position: 'relative' }}>\r\n                                        <span style={{ position: 'absolute', left: '1rem', top: '50%', transform: 'translateY(-50%)', color: 'var(--text-secondary)' }}>‚Ç¨</span>\r\n                                        <input\r\n                                            type=\"number\"\r\n                                            required\r\n                                            min=\"0\"\r\n                                            step=\"0.01\"\r\n                                            value={totalAmount}\r\n                                            onChange={(e) => setTotalAmount(e.target.value)}\r\n                                            style={{ paddingLeft: '2rem' }}\r\n                                            className=\"filter-input\"\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {editingInvoiceId && (\r\n                                    <div className=\"input-group\">\r\n                                        <label>{t('invoices.colPaid')}</label>\r\n                                        <div style={{ position: 'relative' }}>\r\n                                            <span style={{ position: 'absolute', left: '1rem', top: '50%', transform: 'translateY(-50%)', color: 'var(--text-secondary)' }}>‚Ç¨</span>\r\n                                            <input\r\n                                                type=\"number\"\r\n                                                min=\"0\"\r\n                                                step=\"0.01\"\r\n                                                value={paidAmount}\r\n                                                onChange={(e) => setPaidAmount(e.target.value)}\r\n                                                style={{ paddingLeft: '2rem' }}\r\n                                                className=\"filter-input\"\r\n                                            />\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n\r\n                                <div className=\"input-group\">\r\n                                    <label>{t('invoices.colDue')}</label>\r\n                                    <input type=\"date\" required value={dueDate} onChange={(e) => setDueDate(e.target.value)} className=\"filter-input\" />\r\n                                </div>\r\n\r\n                                <div className=\"input-group\">\r\n                                    <label>{t('invoices.description')}</label>\r\n                                    <input type=\"text\" value={description} onChange={(e) => setDescription(e.target.value)} className=\"filter-input\" />\r\n                                </div>\r\n\r\n                                <div style={{ display: 'flex', gap: '1rem', marginTop: '1rem' }}>\r\n                                    <button type=\"button\" className=\"btn btn-outline\" style={{ flex: 1 }} onClick={() => setIsCreateModalOpen(false)}>\r\n                                        {t('transactions.cancel')}\r\n                                    </button>\r\n                                    <button type=\"submit\" className=\"btn btn-primary\" style={{ flex: 1 }}>\r\n                                        {editingInvoiceId ? '–ó–∞–ø–∞–∑–∏' : t('invoices.saveInvoice')}\r\n                                    </button>\r\n                                </div>\r\n                            </form>\r\n                        </motion.div>\r\n                    </div>\r\n                )}\r\n            </AnimatePresence>\r\n\r\n            {/* Add Payment Modal */}\r\n            <AnimatePresence>\r\n                {isPaymentModalOpen && selectedInvoice && (\r\n                    <div className=\"modal-overlay\" onClick={() => setIsPaymentModalOpen(false)}>\r\n                        <motion.div\r\n                            initial={{ scale: 0.95, opacity: 0 }}\r\n                            animate={{ scale: 1, opacity: 1 }}\r\n                            exit={{ scale: 0.95, opacity: 0 }}\r\n                            className=\"glass-panel\"\r\n                            style={{ padding: '2rem', width: '100%', maxWidth: '500px' }}\r\n                            onClick={e => e.stopPropagation()}\r\n                        >\r\n                            <h2 style={{ marginBottom: '1.5rem', color: 'var(--text-primary)' }}>{t('invoices.addPayment')}</h2>\r\n                            <p style={{ marginBottom: '1rem', color: 'var(--text-secondary)' }}>\r\n                                {t('invoices.colClient')}: <strong style={{ color: 'var(--text-primary)' }}>{selectedInvoice.clientName}</strong>\r\n                            </p>\r\n\r\n                            <form onSubmit={handleAddPayment} style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>\r\n\r\n                                <div className=\"input-group\">\r\n                                    <label>{t('invoices.paymentAmount')} *</label>\r\n                                    <div style={{ position: 'relative' }}>\r\n                                        <span style={{ position: 'absolute', left: '1rem', top: '50%', transform: 'translateY(-50%)', color: 'var(--text-secondary)' }}>‚Ç¨</span>\r\n                                        <input\r\n                                            type=\"number\"\r\n                                            required\r\n                                            min=\"0\"\r\n                                            max={selectedInvoice.totalAmount - (selectedInvoice.paidAmount || 0)} // Can't overpay\r\n                                            step=\"0.01\"\r\n                                            value={paymentAmount}\r\n                                            onChange={(e) => setPaymentAmount(e.target.value)}\r\n                                            style={{ paddingLeft: '2rem' }}\r\n                                            className=\"filter-input\"\r\n                                        />\r\n                                    </div>\r\n                                    <small style={{ color: 'var(--text-muted)' }}>\r\n                                        Remaining Balance: {formatCurrency(selectedInvoice.totalAmount - (selectedInvoice.paidAmount || 0))}\r\n                                    </small>\r\n                                </div>\r\n\r\n                                <div className=\"input-group\">\r\n                                    <label>{t('transactions.paymentMethod')}</label>\r\n                                    <div style={{ display: 'flex', gap: '1rem', padding: '0.5rem 0' }}>\r\n                                        <label style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', cursor: 'pointer', color: 'var(--text-primary)' }}>\r\n                                            <input\r\n                                                type=\"radio\"\r\n                                                name=\"paymentMethod\"\r\n                                                value=\"cash\"\r\n                                                checked={paymentMethod === 'cash'}\r\n                                                onChange={(e) => setPaymentMethod(e.target.value)}\r\n                                            />\r\n                                            {t('transactions.cash')}\r\n                                        </label>\r\n                                        <label style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', cursor: 'pointer', color: 'var(--text-primary)' }}>\r\n                                            <input\r\n                                                type=\"radio\"\r\n                                                name=\"paymentMethod\"\r\n                                                value=\"bank\"\r\n                                                checked={paymentMethod === 'bank'}\r\n                                                onChange={(e) => setPaymentMethod(e.target.value)}\r\n                                            />\r\n                                            {t('transactions.bank')}\r\n                                        </label>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div style={{ display: 'flex', gap: '1rem', marginTop: '1rem' }}>\r\n                                    <button type=\"button\" className=\"btn btn-outline\" style={{ flex: 1 }} onClick={() => setIsPaymentModalOpen(false)}>\r\n                                        {t('transactions.cancel')}\r\n                                    </button>\r\n                                    <button type=\"submit\" className=\"btn btn-primary\" style={{ flex: 1 }}>\r\n                                        {t('invoices.savePayment')}\r\n                                    </button>\r\n                                </div>\r\n                            </form>\r\n                        </motion.div>\r\n                    </div>\r\n                )}\r\n            </AnimatePresence>\r\n\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\User\\.gemini\\antigravity\\playground\\swift-intergalactic\\src\\pages\\Login.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'motion' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":5,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":16,"suggestions":[{"messageId":"removeVar","data":{"varName":"motion"},"fix":{"range":[191,230],"text":""},"desc":"Remove unused variable 'motion'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'t' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":15,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":14,"suggestions":[{"messageId":"removeVar","data":{"varName":"t"},"fix":{"range":[601,632],"text":""},"desc":"Remove unused variable 't'."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { motion } from 'framer-motion';\r\nimport { Mail, Lock, ArrowRight, ShieldCheck } from 'lucide-react';\r\n\r\nexport const Login = () => {\r\n    const [email, setEmail] = useState('');\r\n    const [password, setPassword] = useState('');\r\n    const [error, setError] = useState('');\r\n    const [loading, setLoading] = useState(false);\r\n    const { login } = useAuth();\r\n    const navigate = useNavigate();\r\n    const { t } = useTranslation();\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        try {\r\n            setError('');\r\n            setLoading(true);\r\n            await login(email, password);\r\n            navigate('/');\r\n        } catch (err) {\r\n            setError('Failed to sign in: ' + err.message);\r\n        }\r\n        setLoading(false);\r\n    };\r\n\r\n    return (\r\n        <div style={{ display: 'flex', minHeight: '100vh', background: 'var(--bg-darker)' }}>\r\n\r\n            {/* Left Branding Panel - Hidden on Small Screens */}\r\n            <motion.div\r\n                initial={{ opacity: 0, x: -50 }}\r\n                animate={{ opacity: 1, x: 0 }}\r\n                transition={{ duration: 0.6, ease: \"easeOut\" }}\r\n                style={{\r\n                    flex: 1,\r\n                    display: typeof window !== 'undefined' && window.innerWidth > 768 ? 'flex' : 'none',\r\n                    flexDirection: 'column',\r\n                    justifyContent: 'center',\r\n                    padding: '4rem',\r\n                    position: 'relative',\r\n                    overflow: 'hidden',\r\n                    background: 'linear-gradient(135deg, rgba(15,23,42,1) 0%, rgba(2,6,23,1) 100%)'\r\n                }}\r\n            >\r\n                {/* Decorative Background Elements */}\r\n                <div style={{\r\n                    position: 'absolute',\r\n                    top: '-20%',\r\n                    left: '-10%',\r\n                    width: '600px',\r\n                    height: '600px',\r\n                    background: 'radial-gradient(circle, var(--primary-glow) 0%, transparent 70%)',\r\n                    filter: 'blur(60px)',\r\n                    opacity: 0.5,\r\n                    zIndex: 0\r\n                }} />\r\n\r\n                <div style={{ position: 'relative', zIndex: 1, maxWidth: '500px' }}>\r\n                    <div style={{ display: 'inline-flex', alignItems: 'center', gap: '0.75rem', padding: '0.5rem 1rem', background: 'rgba(255,255,255,0.05)', borderRadius: '999px', border: '1px solid rgba(255,255,255,0.1)', marginBottom: '2rem' }}>\r\n                        <ShieldCheck size={18} style={{ color: 'var(--success-color)' }} />\r\n                        <span style={{ fontSize: '0.85rem', fontWeight: 500, color: 'var(--text-secondary)' }}>Enterprise Grade Security</span>\r\n                    </div>\r\n\r\n                    <h1 style={{ fontSize: '3.5rem', lineHeight: 1.1, marginBottom: '1.5rem', fontWeight: 700 }}>\r\n                        <span style={{ color: 'white' }}>Manage your</span><br />\r\n                        <span className=\"text-gradient\">finances</span><br />\r\n                        <span style={{ color: 'white' }}>at lightspeed.</span>\r\n                    </h1>\r\n\r\n                    <p style={{ fontSize: '1.1rem', color: 'var(--text-secondary)', lineHeight: 1.6 }}>\r\n                        FinDash provides a lightning-fast, highly secure dashboard to track transactions, manage payroll, and analyze your growth effortlessly.\r\n                    </p>\r\n                </div>\r\n            </motion.div>\r\n\r\n            {/* Right Login Form Panel */}\r\n            <div style={{\r\n                flex: 1,\r\n                display: 'flex',\r\n                justifyContent: 'center',\r\n                alignItems: 'center',\r\n                padding: '2rem',\r\n                position: 'relative',\r\n                zIndex: 1\r\n            }}>\r\n                <motion.div\r\n                    initial={{ opacity: 0, y: 20 }}\r\n                    animate={{ opacity: 1, y: 0 }}\r\n                    transition={{ duration: 0.4, delay: 0.2 }}\r\n                    className=\"glass-panel\"\r\n                    style={{\r\n                        padding: '3rem',\r\n                        width: '100%',\r\n                        maxWidth: '440px',\r\n                        display: 'flex',\r\n                        flexDirection: 'column',\r\n                        border: '1px solid rgba(255,255,255,0.05)',\r\n                        background: 'rgba(15, 23, 42, 0.4)',\r\n                        boxShadow: '0 25px 50px -12px rgba(0, 0, 0, 0.5)'\r\n                    }}\r\n                >\r\n                    <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', marginBottom: '2.5rem' }}>\r\n                        <div style={{ width: '56px', height: '56px', borderRadius: '16px', background: 'linear-gradient(135deg, var(--primary), var(--primary-hover))', display: 'grid', placeItems: 'center', color: 'white', fontSize: '1.75rem', marginBottom: '1.5rem', boxShadow: '0 0 20px var(--primary-glow)' }}>\r\n                            ‚Ç¨\r\n                        </div>\r\n                        <h2 style={{ fontSize: '1.8rem', fontWeight: 600, color: 'white', marginBottom: '0.5rem' }}>Welcome Back</h2>\r\n                        <p style={{ color: 'var(--text-secondary)', fontSize: '0.95rem' }}>Enter your credentials to access your dashboard</p>\r\n                    </div>\r\n\r\n                    {error && (\r\n                        <motion.div\r\n                            initial={{ opacity: 0, scale: 0.95 }}\r\n                            animate={{ opacity: 1, scale: 1 }}\r\n                            style={{ background: 'rgba(239, 68, 68, 0.1)', border: '1px solid rgba(239, 68, 68, 0.2)', color: 'var(--danger-color)', padding: '1rem', borderRadius: 'var(--radius-md)', marginBottom: '1.5rem', display: 'flex', alignItems: 'center', gap: '0.75rem', fontSize: '0.85rem' }}\r\n                        >\r\n                            <ShieldCheck size={16} />\r\n                            {error}\r\n                        </motion.div>\r\n                    )}\r\n\r\n                    <form onSubmit={handleSubmit} style={{ width: '100%', display: 'flex', flexDirection: 'column', gap: '1.25rem' }}>\r\n                        <div>\r\n                            <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.85rem', fontWeight: 500, color: 'var(--text-secondary)' }}>Email Address</label>\r\n                            <div style={{ position: 'relative' }}>\r\n                                <Mail size={18} style={{ position: 'absolute', left: '1rem', top: '50%', transform: 'translateY(-50%)', color: 'var(--text-muted)' }} />\r\n                                <input\r\n                                    type=\"email\"\r\n                                    className=\"input\"\r\n                                    required\r\n                                    placeholder=\"name@company.com\"\r\n                                    value={email}\r\n                                    onChange={(e) => setEmail(e.target.value)}\r\n                                    style={{\r\n                                        width: '100%',\r\n                                        paddingLeft: '2.75rem',\r\n                                        height: '48px',\r\n                                        background: 'rgba(0,0,0,0.2)',\r\n                                        border: '1px solid rgba(255,255,255,0.05)',\r\n                                        color: 'white'\r\n                                    }}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div>\r\n                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '0.5rem' }}>\r\n                                <label style={{ fontSize: '0.85rem', fontWeight: 500, color: 'var(--text-secondary)' }}>Password</label>\r\n                            </div>\r\n                            <div style={{ position: 'relative' }}>\r\n                                <Lock size={18} style={{ position: 'absolute', left: '1rem', top: '50%', transform: 'translateY(-50%)', color: 'var(--text-muted)' }} />\r\n                                <input\r\n                                    type=\"password\"\r\n                                    className=\"input\"\r\n                                    required\r\n                                    placeholder=\"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢\"\r\n                                    value={password}\r\n                                    onChange={(e) => setPassword(e.target.value)}\r\n                                    style={{\r\n                                        width: '100%',\r\n                                        paddingLeft: '2.75rem',\r\n                                        height: '48px',\r\n                                        background: 'rgba(0,0,0,0.2)',\r\n                                        border: '1px solid rgba(255,255,255,0.05)',\r\n                                        color: 'white'\r\n                                    }}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <button\r\n                            type=\"submit\"\r\n                            disabled={loading}\r\n                            className=\"btn btn-primary\"\r\n                            style={{\r\n                                width: '100%',\r\n                                height: '48px',\r\n                                justifyContent: 'center',\r\n                                marginTop: '1rem',\r\n                                fontSize: '1rem',\r\n                                opacity: loading ? 0.7 : 1,\r\n                                transition: 'all 0.2s'\r\n                            }}\r\n                        >\r\n                            {loading ? 'Authenticating...' : (\r\n                                <>\r\n                                    Sign In <ArrowRight size={18} />\r\n                                </>\r\n                            )}\r\n                        </button>\r\n                    </form>\r\n                </motion.div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\User\\.gemini\\antigravity\\playground\\swift-intergalactic\\src\\pages\\Payroll.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'motion' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":3,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":16,"suggestions":[{"messageId":"removeVar","data":{"varName":"motion"},"fix":{"range":[112,119],"text":""},"desc":"Remove unused variable 'motion'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'deleteTimeLog' is assigned a value but never used. Allowed unused vars must match /^[A-Z_]/u.","line":13,"column":91,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":104,"suggestions":[{"messageId":"removeVar","data":{"varName":"deleteTimeLog"},"fix":{"range":[689,704],"text":""},"desc":"Remove unused variable 'deleteTimeLog'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'addTimeLog' is defined but never used.","line":71,"column":49,"nodeType":"Identifier","messageId":"unusedVar","endLine":71,"endColumn":59,"suggestions":[{"messageId":"removeVar","data":{"varName":"addTimeLog"},"fix":{"range":[3584,3596],"text":""},"desc":"Remove unused variable 'addTimeLog'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'t' is defined but never used.","line":701,"column":81,"nodeType":"Identifier","messageId":"unusedVar","endLine":701,"endColumn":82,"suggestions":[{"messageId":"removeVar","data":{"varName":"t"},"fix":{"range":[56905,56908],"text":""},"desc":"Remove unused variable 't'."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useContext } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { Users, Clock, Calculator, Plus, Trash2, Edit2, Save, Send, Check, X, Calendar } from 'lucide-react';\r\nimport { FinanceContext } from '../context/FinanceContext';\r\nimport { doc, updateDoc, addDoc, collection } from 'firebase/firestore';\r\nimport { db } from '../firebase';\r\n\r\nexport const Payroll = () => {\r\n    const { t } = useTranslation();\r\n    const { userRole } = useAuth();\r\n    const { employees, timeLogs, addEmployee, updateEmployee, deleteEmployee, addTimeLog, deleteTimeLog } = useContext(FinanceContext);\r\n    const [activeTab, setActiveTab] = useState('time'); // 'time', 'salary', 'employees'\r\n\r\n    return (\r\n        <div style={{ maxWidth: '1200px', margin: '0 auto' }}>\r\n            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '2rem' }}>\r\n                <div>\r\n                    <h1 className=\"text-gradient\" style={{ fontSize: '2.5rem', marginBottom: '0.5rem' }}>{t('payroll.title')}</h1>\r\n                    <p style={{ color: 'var(--text-secondary)' }}>{t('payroll.subtitle')}</p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Tabs */}\r\n            <div style={{ marginBottom: '2rem' }}>\r\n                <div className=\"segment-control\" style={{ maxWidth: '100%', flexWrap: 'wrap' }}>\r\n                    <button\r\n                        className={`segment-btn ${activeTab === 'time' ? 'active' : ''}`}\r\n                        onClick={() => setActiveTab('time')}\r\n                    >\r\n                        <Clock size={16} />\r\n                        {t('payroll.timeTracking')}\r\n                    </button>\r\n                    {userRole !== 'manager' && (\r\n                        <button\r\n                            className={`segment-btn ${activeTab === 'salary' ? 'active' : ''}`}\r\n                            onClick={() => setActiveTab('salary')}\r\n                        >\r\n                            <Calculator size={16} />\r\n                            {t('payroll.salaryCalc')}\r\n                        </button>\r\n                    )}\r\n                    <button\r\n                        className={`segment-btn ${activeTab === 'employees' ? 'active' : ''}`}\r\n                        onClick={() => setActiveTab('employees')}\r\n                    >\r\n                        <Users size={16} />\r\n                        {t('payroll.employees')}\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            <AnimatePresence mode=\"wait\">\r\n                <motion.div\r\n                    key={activeTab}\r\n                    initial={{ opacity: 0, y: 10 }}\r\n                    animate={{ opacity: 1, y: 0 }}\r\n                    exit={{ opacity: 0, y: -10 }}\r\n                    transition={{ duration: 0.2 }}\r\n                >\r\n                    {activeTab === 'time' && <TimeTrackingTab employees={employees} timeLogs={timeLogs} addTimeLog={addTimeLog} t={t} />}\r\n                    {activeTab === 'salary' && <SalaryTab employees={employees} timeLogs={timeLogs} t={t} />}\r\n                    {activeTab === 'employees' && <EmployeesTab employees={employees} addEmployee={addEmployee} updateEmployee={updateEmployee} deleteEmployee={deleteEmployee} t={t} />}\r\n                </motion.div>\r\n            </AnimatePresence>\r\n        </div>\r\n    );\r\n};\r\n\r\nconst TimeTrackingTab = ({ employees, timeLogs, addTimeLog, t }) => {\r\n    const { userRole } = useAuth();\r\n    const today = new Date();\r\n    const currentMonth = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}`;\r\n    const [selectedMonth, setSelectedMonth] = useState(currentMonth);\r\n\r\n    const [yearStr, monthStr] = selectedMonth.split('-');\r\n    const year = parseInt(yearStr);\r\n    const month = parseInt(monthStr);\r\n    const daysInMonth = new Date(year, month, 0).getDate();\r\n    const daysArray = Array.from({ length: daysInMonth }, (_, i) => i + 1);\r\n\r\n    const handleTimeChange = async (employeeId, day, value) => {\r\n        const numValue = value; // assuming 'value' is already parsed/clean\r\n        const existingLog = timeLogs.find(log => log.employeeId === employeeId && log.month === selectedMonth);\r\n\r\n        let newDailyHours = {};\r\n        if (existingLog && existingLog.dailyHours) {\r\n            newDailyHours = { ...existingLog.dailyHours };\r\n        }\r\n\r\n        if (newDailyHours[day] === numValue) return;\r\n\r\n        newDailyHours[day] = numValue;\r\n\r\n        if (existingLog) {\r\n            try {\r\n                await updateDoc(doc(db, 'timeLogs', existingLog.id), {\r\n                    dailyHours: newDailyHours\r\n                });\r\n            } catch (e) {\r\n                console.error(\"Error updating time log\", e);\r\n            }\r\n        } else {\r\n            try {\r\n                await addDoc(collection(db, 'timeLogs'), {\r\n                    employeeId,\r\n                    month: selectedMonth,\r\n                    dailyHours: newDailyHours\r\n                });\r\n            } catch (e) {\r\n                console.error(\"Error creating time log\", e);\r\n            }\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"glass-panel\" style={{ padding: '2rem' }}>\r\n            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '2rem' }}>\r\n                <div>\r\n                    <h2 style={{ fontSize: '1.5rem', marginBottom: '0.25rem' }}>{t('payroll.timeTracking')}</h2>\r\n                    <p style={{ color: 'var(--text-secondary)' }}>–û—Ç—á–∏—Ç–∞–Ω–µ –Ω–∞ —Ä–∞–±–æ—Ç–Ω–∏ —á–∞—Å–æ–≤–µ –ø–æ –¥–Ω–∏.</p>\r\n                </div>\r\n                <div>\r\n                    <input\r\n                        type=\"month\"\r\n                        className=\"modern-calendar\"\r\n                        value={selectedMonth}\r\n                        onChange={(e) => setSelectedMonth(e.target.value)}\r\n                    />\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"table-container\" style={{ overflowX: 'auto', paddingBottom: '1rem', border: '1px solid var(--panel-border)', borderRadius: 'var(--radius-md)' }}>\r\n                <table className=\"table payroll-grid time-tracking-table\" style={{ whiteSpace: 'nowrap', minWidth: 'max-content', margin: 0 }}>\r\n                    <thead>\r\n                        <tr>\r\n                            <th style={{ position: 'sticky', left: 0, zIndex: 10, background: 'var(--panel-bg)', minWidth: '150px' }}>–ò–ú–ï–ù–ê–¢–ê</th>\r\n                            <th style={{ position: 'sticky', left: '150px', zIndex: 10, background: 'var(--panel-bg)', minWidth: '80px', borderRight: '2px solid var(--panel-border)' }}>–ó–ê–ü–õ–ê–¢–ê</th>\r\n                            {daysArray.map(day => (\r\n                                <th key={day} style={{ textAlign: 'center', width: '35px', padding: '0.5rem 0.25rem' }}>{day}</th>\r\n                            ))}\r\n                            <th style={{ textAlign: 'center', fontWeight: 'bold', borderLeft: '2px solid var(--panel-border)' }}>–û–ë–©–û</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        {Object.entries(\r\n                            employees.reduce((acc, emp) => {\r\n                                const role = emp.role || '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏—è';\r\n                                if (!acc[role]) acc[role] = [];\r\n                                acc[role].push(emp);\r\n                                return acc;\r\n                            }, {})\r\n                        ).map(([role, roleEmployees]) => (\r\n                            <React.Fragment key={role}>\r\n                                <tr>\r\n                                    <td colSpan={daysInMonth + 3} style={{ background: 'var(--panel-bg)', fontWeight: 'bold', color: 'var(--primary-color)', padding: '0.75rem 1rem', borderTop: '2px solid var(--panel-border)', borderBottom: '2px solid var(--panel-border)', position: 'sticky', left: 0, zIndex: 15 }}>\r\n                                        {role}\r\n                                    </td>\r\n                                </tr>\r\n                                {roleEmployees.map((emp, index) => {\r\n                                    const currentLog = timeLogs.find(l => l.employeeId === emp.id && l.month === selectedMonth) || {};\r\n                                    const dailyHours = currentLog.dailyHours || {};\r\n                                    const totalHours = Object.values(dailyHours).reduce((acc, val) => acc + (parseFloat(val) || 0), 0);\r\n                                    const bgVar = index % 2 === 0 ? 'var(--bg-dark)' : 'var(--bg-darker)';\r\n                                    return (\r\n                                        <tr key={emp.id} style={{ background: bgVar }}>\r\n                                            <td style={{ position: 'sticky', left: 0, zIndex: 5, background: bgVar }}><strong>{emp.name}</strong></td>\r\n                                            <td style={{ position: 'sticky', left: '150px', zIndex: 5, background: bgVar, borderRight: '2px solid var(--panel-border)', fontSize: '0.85rem', color: 'var(--text-secondary)' }}>\r\n                                                {userRole === 'admin' ? (emp.hourlyRate ? `${emp.hourlyRate.toFixed(2)} /—á` : '-') : '***'}\r\n                                            </td>\r\n                                            {daysArray.map(day => {\r\n                                                const val = dailyHours[day] || '';\r\n                                                return (\r\n                                                    <td key={day} style={{ padding: 0, borderRight: '1px solid var(--panel-border)' }}>\r\n                                                        <input\r\n                                                            type=\"text\"\r\n                                                            disabled={userRole === 'viewer'}\r\n                                                            style={{ width: '40px', height: '100%', padding: '0.5rem 0', textAlign: 'center', border: 'none', outline: 'none', background: 'transparent', color: val ? 'var(--text-primary)' : 'var(--text-muted)' }}\r\n                                                            defaultValue={val === 0 ? '' : val}\r\n                                                            onBlur={(e) => {\r\n                                                                const typedValue = e.target.value.trim();\r\n                                                                let cleanVal = val;\r\n                                                                if (typedValue === '') cleanVal = 0;\r\n                                                                else {\r\n                                                                    const parsed = parseFloat(typedValue.replace(',', '.'));\r\n                                                                    if (!isNaN(parsed)) cleanVal = parsed;\r\n                                                                }\r\n                                                                if (cleanVal !== val && (cleanVal !== 0 || val !== '')) {\r\n                                                                    handleTimeChange(emp.id, day, cleanVal);\r\n                                                                }\r\n                                                            }}\r\n                                                            onFocus={(e) => e.target.select()}\r\n                                                        />\r\n                                                    </td>\r\n                                                )\r\n                                            })}\r\n                                            <td style={{ textAlign: 'center', fontWeight: 'bold', borderLeft: '2px solid var(--panel-border)', background: bgVar, color: 'var(--primary-color)' }}>\r\n                                                {totalHours > 0 ? totalHours : '-'}\r\n                                            </td>\r\n                                        </tr>\r\n                                    );\r\n                                })}\r\n                            </React.Fragment>\r\n                        ))}\r\n                        {employees.length === 0 && (\r\n                            <tr>\r\n                                <td colSpan={daysInMonth + 3} style={{ textAlign: 'center', padding: '2rem', color: 'var(--text-secondary)' }}>\r\n                                    –ù—è–º–∞ —Å—ä–∑–¥–∞–¥–µ–Ω–∏ —Å–ª—É–∂–∏—Ç–µ–ª–∏.\r\n                                </td>\r\n                            </tr>\r\n                        )}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n            <div style={{ marginTop: '1rem', display: 'flex', justifyContent: 'flex-end', gap: '1rem' }}>\r\n                <p style={{ color: 'var(--success-color)', fontSize: '0.9rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}><Save size={16} /> –ò–∑–º–µ–Ω–µ–Ω–∏—è—Ç–∞ —Å–µ –∑–∞–ø–∞–∑–≤–∞—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ</p>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nconst SalaryTab = ({ employees, timeLogs, t }) => {\r\n    const { userRole } = useAuth();\r\n    const { addTransaction, updateTransaction, deleteTransaction, transactions, updateEmployee } = useContext(FinanceContext);\r\n    const today = new Date();\r\n    const currentMonth = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}`;\r\n    const [selectedMonth, setSelectedMonth] = useState(currentMonth);\r\n    const [processingId, setProcessingId] = useState(null);\r\n    const [advanceModeId, setAdvanceModeId] = useState(null);\r\n    const [advanceAmount, setAdvanceAmount] = useState('');\r\n    const [editAdvanceModeId, setEditAdvanceModeId] = useState(null);\r\n    const [editAdvanceAmount, setEditAdvanceAmount] = useState('');\r\n    const [travelExpenseModeId, setTravelExpenseModeId] = useState(null);\r\n    const [travelExpenseAmount, setTravelExpenseAmount] = useState('');\r\n\r\n    let grandTotal = 0;\r\n\r\n    return (\r\n        <div className=\"glass-panel\" style={{ padding: '2rem' }}>\r\n            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '2rem' }}>\r\n                <div>\r\n                    <h2 style={{ fontSize: '1.5rem', marginBottom: '0.25rem' }}>{t('payroll.salaryCalc')}</h2>\r\n                    <p style={{ color: 'var(--text-secondary)' }}>–§–∏–Ω–∞–ª–µ–Ω –µ–∫—Ä–∞–Ω –∑–∞ –≤—ä–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è (–í–µ–¥–æ–º–æ—Å—Ç).</p>\r\n                </div>\r\n                <div>\r\n                    <input\r\n                        type=\"month\"\r\n                        className=\"modern-calendar\"\r\n                        value={selectedMonth}\r\n                        onChange={(e) => setSelectedMonth(e.target.value)}\r\n                    />\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"table-container\">\r\n                <table className=\"table payroll-grid salary-table\">\r\n                    <thead>\r\n                        <tr>\r\n                            <th>–°–ª—É–∂–∏—Ç–µ–ª</th>\r\n                            <th>–ù–∞—á–∏–Ω</th>\r\n                            <th>–û—Ç—Ä–∞–±–æ—Ç–µ–Ω–∏ –î–Ω–∏/–ß–∞—Å–æ–≤–µ</th>\r\n                            <th style={{ textAlign: 'center' }}>–°—Ç–∞–≤–∫–∞</th>\r\n                            <th style={{ textAlign: 'right' }}>–ü—ä—Ç–Ω–∏</th>\r\n                            <th style={{ textAlign: 'right' }}>–ê–≤–∞–Ω—Å–∏</th>\r\n                            {userRole === 'admin' && <th style={{ textAlign: 'right' }}>–û—Å—Ç–∞—Ç—ä–∫ –∑–∞ –ü–ª–∞—â–∞–Ω–µ</th>}\r\n                            <th style={{ textAlign: 'right' }}>–î–µ–π—Å—Ç–≤–∏—è</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        {employees.length === 0 ? (\r\n                            <tr>\r\n                                <td colSpan={userRole === 'admin' ? 8 : 7} style={{ textAlign: 'center', padding: '2rem', color: 'var(--text-secondary)' }}>\r\n                                    –ù—è–º–∞ –¥–∞–Ω–Ω–∏.\r\n                                </td>\r\n                            </tr>\r\n                        ) : (\r\n                            Object.entries(\r\n                                employees.reduce((acc, emp) => {\r\n                                    const role = emp.role || '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏—è';\r\n                                    if (!acc[role]) acc[role] = [];\r\n                                    acc[role].push(emp);\r\n                                    return acc;\r\n                                }, {})\r\n                            ).map(([role, roleEmployees]) => (\r\n                                <React.Fragment key={role}>\r\n                                    <tr>\r\n                                        <td colSpan={userRole === 'admin' ? 8 : 7} style={{ background: 'var(--panel-bg)', fontWeight: 'bold', color: 'var(--primary-color)', padding: '0.75rem 1rem', borderTop: '2px solid var(--panel-border)', borderBottom: '2px solid var(--panel-border)' }}>\r\n                                            {role}\r\n                                        </td>\r\n                                    </tr>\r\n                                    {roleEmployees.map((emp) => {\r\n                                        const currentLog = timeLogs.find(l => l.employeeId === emp.id && l.month === selectedMonth) || {};\r\n                                        const dailyHours = currentLog.dailyHours || {};\r\n                                        const advances = currentLog.advances || [];\r\n                                        const isPaid = currentLog.isPaid === true;\r\n\r\n                                        const totalAdvances = advances.reduce((sum, advance) => sum + (parseFloat(advance.amount) || 0), 0);\r\n\r\n                                        const travels = currentLog.travelExpenses || [];\r\n                                        const totalTravels = travels.reduce((sum, t) => sum + (parseFloat(t.amount) || 0), 0);\r\n\r\n                                        const totalHours = Object.values(dailyHours).reduce((acc, val) => acc + (parseFloat(val) || 0), 0);\r\n                                        const totalDays = Object.values(dailyHours).filter(val => (parseFloat(val) || 0) > 0).length;\r\n\r\n                                        let baseSalary = 0;\r\n\r\n                                        if (emp.hourlyRate) {\r\n                                            baseSalary = totalHours * emp.hourlyRate;\r\n                                        } else if (emp.dailyRate) {\r\n                                            baseSalary = totalDays * emp.dailyRate;\r\n                                        }\r\n\r\n                                        const finalSalary = baseSalary + totalTravels;\r\n                                        const remainingSalary = finalSalary > 0 ? Math.max(0, finalSalary - totalAdvances) : 0;\r\n\r\n                                        grandTotal += remainingSalary;\r\n\r\n                                        return (\r\n                                            <tr key={emp.id}>\r\n                                                <td data-label=\"–°–ª—É–∂–∏—Ç–µ–ª\" style={{ padding: '0.75rem' }}>\r\n                                                    <strong>{emp.name}</strong><br />\r\n                                                    <span style={{ fontSize: '0.8rem', color: 'var(--text-secondary)' }}>{emp.role}</span>\r\n                                                </td>\r\n                                                <td style={{ padding: '0.25rem' }} data-label=\"–ù–∞—á–∏–Ω\">\r\n                                                    <select\r\n                                                        value={emp.paymentMethod || 'cash'}\r\n                                                        onChange={(e) => updateEmployee(emp.id, { paymentMethod: e.target.value })}\r\n                                                        style={{\r\n                                                            background: 'transparent',\r\n                                                            border: '1px solid var(--panel-border)',\r\n                                                            color: 'var(--text-primary)',\r\n                                                            padding: '0.25rem',\r\n                                                            borderRadius: 'var(--radius-sm)',\r\n                                                            width: '100%',\r\n                                                            maxWidth: '120px',\r\n                                                            cursor: 'pointer'\r\n                                                        }}\r\n                                                    >\r\n                                                        <option value=\"cash\" style={{ background: 'var(--bg-dark)' }}>–í –±—Ä–æ–π</option>\r\n                                                        <option value=\"bank\" style={{ background: 'var(--bg-dark)' }}>–ü–æ –±–∞–Ω–∫–∞</option>\r\n                                                    </select>\r\n                                                </td>\r\n                                                <td style={{ textAlign: 'center' }} data-label=\"–î–Ω–∏/–ß–∞—Å–æ–≤–µ\">{`${totalHours} —á.`}</td>\r\n                                                <td style={{ textAlign: 'center' }} data-label=\"–°—Ç–∞–≤–∫–∞\">\r\n                                                    {userRole === 'admin' ? (emp.hourlyRate ? `${emp.hourlyRate.toFixed(2)} ‚Ç¨/—á` : (emp.dailyRate ? `${emp.dailyRate.toFixed(2)} ‚Ç¨/–¥–µ–Ω` : '-')) : '***'}\r\n                                                </td>\r\n                                                <td style={{ textAlign: 'right' }} data-label=\"–ü—ä—Ç–Ω–∏\">\r\n                                                    {travelExpenseModeId === emp.id ? (\r\n                                                        <div style={{ display: 'flex', gap: '0.25rem', justifyContent: 'flex-end', alignItems: 'center' }}>\r\n                                                            <input\r\n                                                                type=\"number\"\r\n                                                                value={travelExpenseAmount}\r\n                                                                onChange={(e) => setTravelExpenseAmount(e.target.value)}\r\n                                                                placeholder=\"–°—É–º–∞ ‚Ç¨\"\r\n                                                                style={{ width: '70px', padding: '0.25rem 0.5rem', borderRadius: '4px', border: '1px solid var(--panel-border)', background: 'var(--bg-dark)', color: 'white', fontSize: '0.8rem' }}\r\n                                                                autoFocus\r\n                                                            />\r\n                                                            <button className=\"btn btn-primary\" style={{ padding: '0.35rem' }} onClick={async () => {\r\n                                                                const amt = parseFloat(travelExpenseAmount.replace(',', '.'));\r\n                                                                if (isNaN(amt) || amt < 0) return alert('–ù–µ–≤–∞–ª–∏–¥–Ω–∞ —Å—É–º–∞.');\r\n                                                                try {\r\n                                                                    let newTravels = [{ amount: amt, date: new Date().toISOString() }];\r\n                                                                    if (currentLog.id) {\r\n                                                                        await updateDoc(doc(db, 'timeLogs', currentLog.id), { travelExpenses: newTravels });\r\n                                                                    } else {\r\n                                                                        await addDoc(collection(db, 'timeLogs'), { employeeId: emp.id, month: selectedMonth, dailyHours: {}, travelExpenses: newTravels });\r\n                                                                    }\r\n                                                                    setTravelExpenseModeId(null);\r\n                                                                } catch (err) { alert(err.message); }\r\n                                                            }}><Check size={14} /></button>\r\n                                                            <button className=\"btn btn-outline\" style={{ padding: '0.35rem' }} onClick={() => setTravelExpenseModeId(null)}><X size={14} /></button>\r\n                                                        </div>\r\n                                                    ) : (\r\n                                                        <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'flex-end', gap: '0.5rem' }}>\r\n                                                            {totalTravels > 0 ? (\r\n                                                                <span style={{ color: 'var(--success-color)', fontWeight: 'bold' }}>+ {totalTravels.toFixed(2)} ‚Ç¨</span>\r\n                                                            ) : <span style={{ color: 'var(--text-secondary)' }}>-</span>}\r\n                                                            {userRole !== 'viewer' && !isPaid && (\r\n                                                                <button\r\n                                                                    className=\"btn btn-outline\"\r\n                                                                    onClick={() => { setTravelExpenseModeId(emp.id); setTravelExpenseAmount(totalTravels > 0 ? totalTravels.toString() : ''); }}\r\n                                                                    title=\"–î–æ–±–∞–≤–∏ –ü—ä—Ç–Ω–∏\"\r\n                                                                    style={{\r\n                                                                        padding: '0.25rem 0.5rem',\r\n                                                                        borderColor: 'var(--primary)',\r\n                                                                        color: 'var(--primary)',\r\n                                                                        display: 'inline-flex',\r\n                                                                        alignItems: 'center',\r\n                                                                        justifyContent: 'center'\r\n                                                                    }}\r\n                                                                >\r\n                                                                    <Plus size={16} strokeWidth={2.5} />\r\n                                                                </button>\r\n                                                            )}\r\n                                                        </div>\r\n                                                    )}\r\n                                                </td>\r\n                                                <td style={{ textAlign: 'right' }} data-label=\"–ê–≤–∞–Ω—Å–∏\">\r\n                                                    {editAdvanceModeId === emp.id ? (\r\n                                                        <div style={{ display: 'flex', gap: '0.25rem', justifyContent: 'flex-end', alignItems: 'center' }}>\r\n                                                            <input\r\n                                                                type=\"number\"\r\n                                                                value={editAdvanceAmount}\r\n                                                                onChange={(e) => setEditAdvanceAmount(e.target.value)}\r\n                                                                style={{ width: '80px', padding: '0.25rem 0.5rem', borderRadius: '4px', border: '1px solid var(--panel-border)', background: 'var(--bg-dark)', color: 'white', fontSize: '0.8rem' }}\r\n                                                                autoFocus\r\n                                                            />\r\n                                                            <button className=\"btn btn-primary\" style={{ padding: '0.35rem' }} onClick={async () => {\r\n                                                                const amt = parseFloat(editAdvanceAmount.replace(',', '.'));\r\n                                                                if (isNaN(amt) || amt < 0) return alert('–ù–µ–≤–∞–ª–∏–¥–Ω–∞ —Å—É–º–∞.');\r\n\r\n                                                                try {\r\n                                                                    const diff = parseFloat((amt - totalAdvances).toFixed(2));\r\n                                                                    if (diff !== 0) {\r\n                                                                        const relatedTxns = transactions.filter(t => t.type === 'expense' && (t.description || '').toLowerCase().includes(emp.name.toLowerCase()) && (t.description || '').toLowerCase().includes('–∞–≤–∞–Ω—Å') && (t.description || '').toLowerCase().includes(selectedMonth.toLowerCase())).sort((a, b) => new Date(b.date) - new Date(a.date));\r\n                                                                        if (diff < 0) {\r\n                                                                            let toRemove = Math.abs(diff);\r\n                                                                            for (let txn of relatedTxns) {\r\n                                                                                if (toRemove <= 0) break;\r\n                                                                                const txnAmt = parseFloat(txn.amount) || 0;\r\n                                                                                if (txnAmt <= toRemove) {\r\n                                                                                    deleteTransaction(txn.id);\r\n                                                                                    toRemove = parseFloat((toRemove - txnAmt).toFixed(2));\r\n                                                                                } else {\r\n                                                                                    updateTransaction(txn.id, { amount: (txnAmt - toRemove).toFixed(2) });\r\n                                                                                    toRemove = 0;\r\n                                                                                }\r\n                                                                            }\r\n                                                                            if (toRemove > 0) {\r\n                                                                                const transactionDate = new Date().toISOString().startsWith(selectedMonth)\r\n                                                                                    ? new Date().toISOString().split('T')[0]\r\n                                                                                    : `${selectedMonth}-01`;\r\n                                                                                addTransaction({\r\n                                                                                    date: transactionDate,\r\n                                                                                    type: 'income',\r\n                                                                                    category: '–ö–æ—Ä–µ–∫—Ü–∏—è',\r\n                                                                                    amount: toRemove.toFixed(2),\r\n                                                                                    description: `–í—ä–∑—Å—Ç–∞–Ω–æ–≤–µ–Ω –∞–≤–∞–Ω—Å: ${emp.name}`,\r\n                                                                                    paymentMethod: 'cash'\r\n                                                                                });\r\n                                                                            }\r\n                                                                        } else {\r\n                                                                            const method = emp.paymentMethod || 'cash';\r\n                                                                            const methodText = method === 'bank' ? '–ø–æ –±–∞–Ω–∫–∞' : '–≤ –±—Ä–æ–π';\r\n\r\n                                                                            if (relatedTxns.length > 0) {\r\n                                                                                const mostRecentTxn = relatedTxns[0];\r\n                                                                                const currentAmt = parseFloat(mostRecentTxn.amount) || 0;\r\n                                                                                updateTransaction(mostRecentTxn.id, { amount: (currentAmt + diff).toFixed(2) });\r\n                                                                            } else {\r\n                                                                                const transactionDate = new Date().toISOString().startsWith(selectedMonth)\r\n                                                                                    ? new Date().toISOString().split('T')[0]\r\n                                                                                    : `${selectedMonth}-01`;\r\n\r\n                                                                                addTransaction({\r\n                                                                                    date: transactionDate,\r\n                                                                                    type: 'expense',\r\n                                                                                    category: emp.role || '–î–†–£–ì–ò –†–ê–°–•–û–î–ò',\r\n                                                                                    amount: diff.toFixed(2),\r\n                                                                                    description: `–ê–≤–∞–Ω—Å: ${emp.name} –∑–∞ ${selectedMonth} (${methodText})`,\r\n                                                                                    paymentMethod: method\r\n                                                                                });\r\n                                                                            }\r\n                                                                        }\r\n                                                                    }\r\n\r\n                                                                    let newAdvances = amt > 0 ? [{ amount: amt, date: new Date().toISOString() }] : [];\r\n                                                                    if (currentLog.id) {\r\n                                                                        await updateDoc(doc(db, 'timeLogs', currentLog.id), { advances: newAdvances });\r\n                                                                    } else if (amt > 0) {\r\n                                                                        await addDoc(collection(db, 'timeLogs'), { employeeId: emp.id, month: selectedMonth, dailyHours: {}, advances: newAdvances });\r\n                                                                    }\r\n                                                                    setEditAdvanceModeId(null);\r\n                                                                } catch (err) { alert(err.message); }\r\n                                                            }}><Check size={14} /></button>\r\n                                                            <button className=\"btn btn-outline\" style={{ padding: '0.35rem' }} onClick={() => setEditAdvanceModeId(null)}><X size={14} /></button>\r\n                                                        </div>\r\n                                                    ) : (\r\n                                                        totalAdvances > 0 ? (\r\n                                                            <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'flex-end', gap: '0.5rem' }}>\r\n                                                                <span style={{\r\n                                                                    background: 'rgba(239, 68, 68, 0.1)',\r\n                                                                    color: 'var(--warning-color)',\r\n                                                                    padding: '0.25rem 0.75rem',\r\n                                                                    borderRadius: '999px',\r\n                                                                    fontWeight: 'bold',\r\n                                                                    display: 'inline-block'\r\n                                                                }}>\r\n                                                                    - {totalAdvances.toFixed(2)} ‚Ç¨\r\n                                                                </span>\r\n                                                                {userRole !== 'viewer' && (\r\n                                                                    <button className=\"btn-icon\" onClick={() => { setEditAdvanceModeId(emp.id); setEditAdvanceAmount(totalAdvances.toString()); }} title=\"–†–µ–¥–∞–∫—Ç–∏—Ä–∞–Ω–µ\" style={{ padding: '0.25rem' }}>\r\n                                                                        <Edit2 size={14} />\r\n                                                                    </button>\r\n                                                                )}\r\n                                                            </div>\r\n                                                        ) : (\r\n                                                            <span style={{ color: 'var(--text-secondary)' }}>-</span>\r\n                                                        )\r\n                                                    )}\r\n                                                </td>\r\n                                                {userRole === 'admin' && (\r\n                                                    <td style={{ textAlign: 'right', fontWeight: 'bold', fontSize: '1.1rem', color: isPaid ? 'var(--text-muted)' : 'var(--primary-color)' }} data-label=\"–û—Å—Ç–∞—Ç—ä–∫\">\r\n                                                        {isPaid ? <span style={{ color: 'var(--success-color)', fontSize: '0.9rem' }}>–ò–∑–ø–ª–∞—Ç–µ–Ω–æ</span> : `${remainingSalary.toFixed(2)} ‚Ç¨`}\r\n                                                    </td>\r\n                                                )}\r\n                                                <td style={{ textAlign: 'right' }} data-label=\"–î–µ–π—Å—Ç–≤–∏—è\">\r\n                                                    <div style={{ display: 'flex', gap: '0.5rem', justifyContent: 'flex-end', opacity: processingId === emp.id ? 0.5 : 1, pointerEvents: processingId === emp.id ? 'none' : 'auto' }}>\r\n                                                        {advanceModeId === emp.id ? (\r\n                                                            <div style={{ display: 'flex', gap: '0.25rem', alignItems: 'center' }}>\r\n                                                                <input\r\n                                                                    type=\"number\"\r\n                                                                    value={advanceAmount}\r\n                                                                    onChange={(e) => setAdvanceAmount(e.target.value)}\r\n                                                                    placeholder=\"–°—É–º–∞ ‚Ç¨\"\r\n                                                                    style={{ width: '80px', padding: '0.25rem 0.5rem', borderRadius: '4px', border: '1px solid var(--panel-border)', background: 'var(--bg-dark)', color: 'white', fontSize: '0.8rem' }}\r\n                                                                    autoFocus\r\n                                                                />\r\n                                                                <button\r\n                                                                    className=\"btn btn-primary\"\r\n                                                                    style={{ padding: '0.35rem' }}\r\n                                                                    onClick={async () => {\r\n                                                                        const amt = parseFloat(advanceAmount.replace(',', '.'));\r\n                                                                        if (isNaN(amt) || amt <= 0) return alert('–ù–µ–≤–∞–ª–∏–¥–Ω–∞ —Å—É–º–∞.');\r\n                                                                        if (amt > remainingSalary && remainingSalary > 0) return alert(`–°—É–º–∞—Ç–∞ –Ω–∞–¥–≤–∏—à–∞–≤–∞ –æ—Å—Ç–∞—Ç—ä–∫–∞ –æ—Ç ${remainingSalary.toFixed(2)} ‚Ç¨`);\r\n\r\n                                                                        setProcessingId(emp.id);\r\n                                                                        try {\r\n                                                                            const method = emp.paymentMethod || 'cash';\r\n                                                                            const methodText = method === 'bank' ? '–ø–æ –±–∞–Ω–∫–∞' : '–≤ –±—Ä–æ–π';\r\n                                                                            const desc = `–ê–≤–∞–Ω—Å: ${emp.name} –∑–∞ ${selectedMonth} (${methodText})`;\r\n\r\n                                                                            // Use the currently selected month and a valid day (01) instead of today's exact date so that the transaction appears correctly in the selected month's ledger.\r\n                                                                            const transactionDate = new Date().toISOString().startsWith(selectedMonth)\r\n                                                                                ? new Date().toISOString().split('T')[0]\r\n                                                                                : `${selectedMonth}-01`;\r\n\r\n                                                                            await addTransaction({\r\n                                                                                date: transactionDate,\r\n                                                                                type: 'expense',\r\n                                                                                category: emp.role || '–î–†–£–ì–ò –†–ê–°–•–û–î–ò',\r\n                                                                                amount: amt.toFixed(2),\r\n                                                                                description: desc,\r\n                                                                                paymentMethod: method\r\n                                                                            });\r\n\r\n                                                                            let newAdvances = [...advances];\r\n                                                                            newAdvances.push({ amount: amt, date: new Date().toISOString() });\r\n\r\n                                                                            if (currentLog.id) {\r\n                                                                                await updateDoc(doc(db, 'timeLogs', currentLog.id), { advances: newAdvances });\r\n                                                                            } else {\r\n                                                                                await addDoc(collection(db, 'timeLogs'), { employeeId: emp.id, month: selectedMonth, dailyHours: {}, advances: newAdvances });\r\n                                                                            }\r\n                                                                            setAdvanceModeId(null);\r\n                                                                            setAdvanceAmount('');\r\n                                                                        } catch (err) {\r\n                                                                            alert(\"–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞–ø–∞–∑–≤–∞–Ω–µ: \" + err.message);\r\n                                                                        }\r\n                                                                        setProcessingId(null);\r\n                                                                    }}\r\n                                                                >\r\n                                                                    <Check size={14} />\r\n                                                                </button>\r\n                                                                <button\r\n                                                                    className=\"btn btn-outline\"\r\n                                                                    style={{ padding: '0.35rem' }}\r\n                                                                    onClick={() => { setAdvanceModeId(null); setAdvanceAmount(''); }}\r\n                                                                >\r\n                                                                    <X size={14} />\r\n                                                                </button>\r\n                                                            </div>\r\n                                                        ) : (\r\n                                                            <>\r\n                                                                <button\r\n                                                                    className=\"btn btn-outline\"\r\n                                                                    style={{ padding: '0.25rem 0.5rem', fontSize: '0.8rem' }}\r\n                                                                    disabled={isPaid}\r\n                                                                    onClick={() => { setAdvanceModeId(emp.id); setAdvanceAmount(''); }}\r\n                                                                >\r\n                                                                    –ê–≤–∞–Ω—Å\r\n                                                                </button>\r\n                                                                {isPaid ? (\r\n                                                                    <button\r\n                                                                        className=\"btn btn-outline\"\r\n                                                                        style={{ padding: '0.25rem 0.5rem', fontSize: '0.8rem', borderColor: 'orange', color: 'orange' }}\r\n                                                                        onClick={async () => {\r\n                                                                            if (!window.confirm(`–û—Ç–º–µ–Ω–∏ –ø–ª–∞—â–∞–Ω–µ—Ç–æ –∑–∞ ${emp.name} –∑–∞ ${selectedMonth}? –¢–æ–≤–∞ —Å—ä—â–æ —â–µ –∏–∑—Ç—Ä–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ç–∞ –∑–∞ –∑–∞–ø–ª–∞—Ç–∞.`)) return;\r\n                                                                            setProcessingId(emp.id);\r\n                                                                            try {\r\n                                                                                const relatedTxns = transactions.filter(t =>\r\n                                                                                    t.type === 'expense' &&\r\n                                                                                    (t.description || '').toLowerCase().includes(emp.name.toLowerCase()) &&\r\n                                                                                    (t.description || '').toLowerCase().includes(selectedMonth.toLowerCase()) &&\r\n                                                                                    (t.description || '').toLowerCase().includes('–∑–∞–ø–ª–∞—Ç–∞')\r\n                                                                                );\r\n                                                                                for (let txn of relatedTxns) {\r\n                                                                                    deleteTransaction(txn.id);\r\n                                                                                }\r\n\r\n                                                                                if (currentLog.id) {\r\n                                                                                    await updateDoc(doc(db, 'timeLogs', currentLog.id), { isPaid: false });\r\n                                                                                }\r\n                                                                            } catch (err) {\r\n                                                                                alert(\"–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞–ø–∞–∑–≤–∞–Ω–µ: \" + err.message);\r\n                                                                            }\r\n                                                                            setProcessingId(null);\r\n                                                                        }}\r\n                                                                    >\r\n                                                                        –û—Ç–º–µ–Ω–∏\r\n                                                                    </button>\r\n                                                                ) : (\r\n                                                                    userRole === 'admin' && (\r\n                                                                        <button\r\n                                                                            className=\"btn btn-primary\"\r\n                                                                            style={{ padding: '0.25rem 0.5rem', fontSize: '0.8rem' }}\r\n                                                                            disabled={remainingSalary <= 0 && totalTravels === 0}\r\n                                                                            onClick={async () => {\r\n                                                                                const method = emp.paymentMethod || 'cash';\r\n                                                                                const methodText = method === 'bank' ? '–ø–æ –±–∞–Ω–∫–∞' : '–≤ –±—Ä–æ–π';\r\n                                                                                const confirmMsg = `–ò–∑–ø–ª–∞—â–∞–Ω–µ: ${emp.name} –∑–∞ ${selectedMonth}\\n–û—Å—Ç–∞—Ç—ä–∫ –ó–∞–ø–ª–∞—Ç–∞: ${(remainingSalary - totalTravels).toFixed(2)} ‚Ç¨\\n–ü—ä—Ç–Ω–∏: ${totalTravels.toFixed(2)} ‚Ç¨\\n–û–ë–©–û: ${remainingSalary.toFixed(2)} ‚Ç¨`;\r\n                                                                                if (!window.confirm(confirmMsg)) return;\r\n                                                                                setProcessingId(emp.id);\r\n                                                                                try {\r\n                                                                                    const transactionDate = new Date().toISOString().startsWith(selectedMonth)\r\n                                                                                        ? new Date().toISOString().split('T')[0]\r\n                                                                                        : `${selectedMonth}-01`;\r\n\r\n                                                                                    const pureSalary = remainingSalary - totalTravels;\r\n\r\n                                                                                    // Transaction 1: Pure Salary Remaining\r\n                                                                                    if (pureSalary > 0) {\r\n                                                                                        await addTransaction({\r\n                                                                                            date: transactionDate,\r\n                                                                                            type: 'expense',\r\n                                                                                            category: emp.role || '–î–†–£–ì–ò –†–ê–°–•–û–î–ò',\r\n                                                                                            amount: pureSalary.toFixed(2),\r\n                                                                                            description: `–ò–∑–ø–ª–∞—Ç–µ–Ω –æ—Å—Ç–∞—Ç—ä–∫ –æ—Ç –∑–∞–ø–ª–∞—Ç–∞: ${emp.name} –∑–∞ ${selectedMonth} (${methodText})`,\r\n                                                                                            paymentMethod: method\r\n                                                                                        });\r\n                                                                                    }\r\n\r\n                                                                                    // Transaction 2: Travel Expenses\r\n                                                                                    if (totalTravels > 0) {\r\n                                                                                        await addTransaction({\r\n                                                                                            date: transactionDate,\r\n                                                                                            type: 'expense',\r\n                                                                                            category: '–ü–™–¢–ù–ò –†–ê–ó–•–û–î–ò',\r\n                                                                                            amount: totalTravels.toFixed(2),\r\n                                                                                            description: `–ò–∑–ø–ª–∞—Ç–µ–Ω–∏ –ø—ä—Ç–Ω–∏ —Ä–∞–∑—Ö–æ–¥–∏: ${emp.name} –∑–∞ ${selectedMonth} (${methodText})`,\r\n                                                                                            paymentMethod: method\r\n                                                                                        });\r\n                                                                                    }\r\n\r\n                                                                                    if (currentLog.id) {\r\n                                                                                        await updateDoc(doc(db, 'timeLogs', currentLog.id), { isPaid: true });\r\n                                                                                    } else {\r\n                                                                                        await addDoc(collection(db, 'timeLogs'), { employeeId: emp.id, month: selectedMonth, dailyHours: {}, isPaid: true });\r\n                                                                                    }\r\n                                                                                } catch (err) {\r\n                                                                                    alert(\"–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞–ø–∞–∑–≤–∞–Ω–µ: \" + err.message);\r\n                                                                                }\r\n                                                                                setProcessingId(null);\r\n                                                                            }}\r\n                                                                        >\r\n                                                                            –ò–∑–ø–ª–∞—Ç–∏\r\n                                                                        </button>\r\n                                                                    )\r\n                                                                )}\r\n                                                            </>\r\n                                                        )}\r\n                                                    </div>\r\n                                                </td>\r\n                                            </tr>\r\n                                        );\r\n                                    })}\r\n                                </React.Fragment>\r\n                            ))\r\n                        )}\r\n                    </tbody>\r\n                    {\r\n                        employees.length > 0 && userRole === 'admin' && (\r\n                            <tfoot>\r\n                                <tr>\r\n                                    <td colSpan=\"6\" style={{ textAlign: 'right', fontWeight: 'bold' }}>–û–±—â–æ –æ—Å—Ç–∞—Ç—ä—á–Ω–∏ –∑–∞–¥—ä–ª–∂–µ–Ω–∏—è (–º–µ—Å–µ—Ü):</td>\r\n                                    <td style={{ textAlign: 'right', fontWeight: 'bold', fontSize: '1.2rem', color: 'var(--success-color)' }}>\r\n                                        {grandTotal.toFixed(2)} ‚Ç¨\r\n                                    </td>\r\n                                    <td></td>\r\n                                </tr>\r\n                            </tfoot>\r\n                        )\r\n                    }\r\n                </table>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nconst EmployeesTab = ({ employees, addEmployee, updateEmployee, deleteEmployee, t }) => {\r\n    const { userRole } = useAuth();\r\n    const [isAdding, setIsAdding] = useState(false);\r\n    const [editingId, setEditingId] = useState(null);\r\n    const [formData, setFormData] = useState({ name: '', role: '', hourlyRate: '', dailyRate: '' });\r\n\r\n    const roleOptions = [\r\n        \"–ó–ê–ü–õ–ê–¢–ê –£–ü–†–ê–í–ò–¢–ï–õ–ò–ò, –û–§–ò–° –ò –í–û–î–ò–¢–ï–õ–¨\",\r\n        \"–ó–ê–ü–õ–ê–¢–ò –†–ï–¶–ï–ü–¶–ò–Ø\",\r\n        \"–ó–ê–ü–õ–ê–¢–ò –ö–ê–ú–ï–†–ò–ï–†–ö–ò\",\r\n        \"–ó–ê–ü–õ–ê–¢–ò –ö–£–•–ù–Ø\",\r\n        \"–ó–ê–ü–õ–ê–¢–ò –°–ï–†–í–ò–¢–¨–û–†–ò,–ß–ï–ö–™–†–ò,–ë–ê–†–ú–ï–ù\",\r\n        \"–ó–ê–ü–õ–ê–¢–ê –°–ü–ê–°–ò–¢–ï–õ–ò\",\r\n        \"–ó–ê–ü–õ–ê–¢–ê –ê–ù–ò–ú–ê–¢–û–†–ò\"\r\n    ];\r\n\r\n    const handleSave = () => {\r\n        if (!formData.name.trim()) return;\r\n\r\n        const payload = {\r\n            name: formData.name,\r\n            role: formData.role,\r\n            hourlyRate: parseFloat(formData.hourlyRate) || 0,\r\n            dailyRate: parseFloat(formData.dailyRate) || 0\r\n        };\r\n\r\n        if (editingId) {\r\n            updateEmployee(editingId, payload);\r\n            setEditingId(null);\r\n        } else {\r\n            addEmployee(payload);\r\n            setIsAdding(false);\r\n        }\r\n        setFormData({ name: '', role: '', hourlyRate: '', dailyRate: '' });\r\n    };\r\n\r\n    const handleEdit = (emp) => {\r\n        setFormData({\r\n            name: emp.name,\r\n            role: emp.role || '',\r\n            hourlyRate: emp.hourlyRate || '',\r\n            dailyRate: emp.dailyRate || ''\r\n        });\r\n        setEditingId(emp.id);\r\n        setIsAdding(true);\r\n    };\r\n\r\n    const handleCancel = () => {\r\n        setIsAdding(false);\r\n        setEditingId(null);\r\n        setFormData({ name: '', role: '', hourlyRate: '', dailyRate: '' });\r\n    };\r\n\r\n    return (\r\n        <div className=\"glass-panel\" style={{ padding: '2rem' }}>\r\n            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '2rem' }}>\r\n                <div>\r\n                    <h2 style={{ fontSize: '1.5rem', marginBottom: '0.25rem' }}>–°–ª—É–∂–∏—Ç–µ–ª–∏</h2>\r\n                    <p style={{ color: 'var(--text-secondary)' }}>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª –∏ –±–∞–∑–æ–≤–∏ —Å—Ç–∞–≤–∫–∏.</p>\r\n                </div>\r\n                {!isAdding && userRole !== 'viewer' && (\r\n                    <button className=\"btn btn-primary\" onClick={() => setIsAdding(true)}>\r\n                        <Plus size={18} />\r\n                        –î–æ–±–∞–≤–∏ —Å–ª—É–∂–∏—Ç–µ–ª\r\n                    </button>\r\n                )}\r\n            </div>\r\n\r\n            {isAdding && (\r\n                <motion.div\r\n                    initial={{ opacity: 0, height: 0 }}\r\n                    animate={{ opacity: 1, height: 'auto' }}\r\n                    style={{ background: 'var(--bg-lighter)', padding: '1.5rem', borderRadius: 'var(--radius-md)', marginBottom: '2rem', border: '1px solid var(--panel-border)' }}\r\n                >\r\n                    <h3 style={{ marginBottom: '1rem' }}>{editingId ? '–†–µ–¥–∞–∫—Ç–∏—Ä–∞–Ω–µ' : '–ù–æ–≤ —Å–ª—É–∂–∏—Ç–µ–ª'}</h3>\r\n                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '1.5rem', marginBottom: '1.5rem' }}>\r\n                        <div className=\"input-group\">\r\n                            <label>–ò–º–µ –Ω–∞ —Å–ª—É–∂–∏—Ç–µ–ª</label>\r\n                            <input type=\"text\" className=\"filter-input\" placeholder=\"–ù–∞–ø—Ä. –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤\" value={formData.name} onChange={(e) => setFormData({ ...formData, name: e.target.value })} style={{ padding: '0.6rem 1rem' }} />\r\n                        </div>\r\n                        <div className=\"input-group\">\r\n                            <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è –ó–∞–ø–ª–∞—Ç–∞</label>\r\n                            <select\r\n                                className=\"filter-input\"\r\n                                value={formData.role}\r\n                                onChange={(e) => setFormData({ ...formData, role: e.target.value })}\r\n                                style={{ width: '100%', padding: '0.6rem 1rem' }}\r\n                            >\r\n                                <option value=\"\">–ò–∑–±–µ—Ä–µ—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è...</option>\r\n                                {roleOptions.map(option => (\r\n                                    <option key={option} value={option}>{option}</option>\r\n                                ))}\r\n                            </select>\r\n                        </div>\r\n\r\n                        {userRole === 'admin' && (\r\n                            <>\r\n                                <div className=\"input-group\">\r\n                                    <label>–°—Ç–∞–≤–∫–∞ –Ω–∞ –ß–∞—Å (‚Ç¨)</label>\r\n                                    <div style={{ position: 'relative' }}>\r\n                                        <span style={{ position: 'absolute', left: '1rem', top: '50%', transform: 'translateY(-50%)', color: 'var(--text-secondary)' }}>‚Ç¨</span>\r\n                                        <input type=\"number\" step=\"0.01\" className=\"filter-input\" placeholder=\"0.00\" value={formData.hourlyRate} onChange={(e) => setFormData({ ...formData, hourlyRate: e.target.value })} style={{ paddingLeft: '2rem' }} />\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"input-group\">\r\n                                    <label>–°—Ç–∞–≤–∫–∞ –∑–∞ –î–µ–Ω (‚Ç¨)</label>\r\n                                    <div style={{ position: 'relative' }}>\r\n                                        <span style={{ position: 'absolute', left: '1rem', top: '50%', transform: 'translateY(-50%)', color: 'var(--text-secondary)' }}>‚Ç¨</span>\r\n                                        <input type=\"number\" step=\"0.01\" className=\"filter-input\" placeholder=\"0.00\" value={formData.dailyRate} onChange={(e) => setFormData({ ...formData, dailyRate: e.target.value })} style={{ paddingLeft: '2rem' }} />\r\n                                    </div>\r\n                                </div>\r\n                            </>\r\n                        )}\r\n                    </div>\r\n                    <div style={{ display: 'flex', gap: '1rem', justifyContent: 'flex-end' }}>\r\n                        <button className=\"btn\" onClick={handleCancel}>–û—Ç–∫–∞–∑</button>\r\n                        <button className=\"btn btn-primary\" onClick={handleSave} disabled={!formData.name.trim()}>–ó–∞–ø–∞–∑–∏</button>\r\n                    </div>\r\n                </motion.div>\r\n            )}\r\n\r\n            <div className=\"table-container\">\r\n                <table className=\"table payroll-grid employees-table\">\r\n                    <thead>\r\n                        <tr>\r\n                            <th style={{ padding: '0.5rem' }}>–ò–º–µ</th>\r\n                            <th style={{ padding: '0.5rem' }}>–î–ª—ä–∂–Ω–æ—Å—Ç</th>\r\n                            {userRole === 'admin' && <th style={{ padding: '0.5rem' }}>–°—Ç–∞–≤–∫–∞ / –ß–∞—Å</th>}\r\n                            {userRole === 'admin' && <th style={{ padding: '0.5rem' }}>–°—Ç–∞–≤–∫–∞ / –î–µ–Ω</th>}\r\n                            {userRole !== 'viewer' && <th style={{ textAlign: 'right', padding: '0.5rem' }}>–î–µ–π—Å—Ç–≤–∏—è</th>}\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        {employees.map(emp => (\r\n                            <tr key={emp.id}>\r\n                                <td style={{ padding: '0.5rem' }} data-label=\"–ò–º–µ\"><strong>{emp.name}</strong></td>\r\n                                <td style={{ padding: '0.5rem' }} data-label=\"–î–ª—ä–∂–Ω–æ—Å—Ç\">{emp.role || '-'}</td>\r\n                                {userRole === 'admin' && <td style={{ padding: '0.5rem' }} data-label=\"–°—Ç–∞–≤–∫–∞ / –ß–∞—Å\">{emp.hourlyRate ? `${emp.hourlyRate.toFixed(2)} ‚Ç¨` : '-'}</td>}\r\n                                {userRole === 'admin' && <td style={{ padding: '0.5rem' }} data-label=\"–°—Ç–∞–≤–∫–∞ / –î–µ–Ω\">{emp.dailyRate ? `${emp.dailyRate.toFixed(2)} ‚Ç¨` : '-'}</td>}\r\n                                {userRole !== 'viewer' && (\r\n                                    <td style={{ padding: '0.5rem' }} data-label=\"–î–µ–π—Å—Ç–≤–∏—è\">\r\n                                        <div style={{ display: 'flex', gap: '0.5rem', justifyContent: 'flex-end', alignItems: 'center' }}>\r\n                                            <button className=\"icon-btn\" onClick={() => handleEdit(emp)} style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', background: 'transparent', border: 'none', cursor: 'pointer', color: 'var(--primary-color)' }}>\r\n                                                <Edit2 size={16} />\r\n                                            </button>\r\n                                            <button className=\"icon-btn\" onClick={() => { if (window.confirm('–°–∏–≥—É—Ä–Ω–∏ –ª–∏ —Å—Ç–µ?')) deleteEmployee(emp.id); }} style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', background: 'transparent', border: 'none', cursor: 'pointer', color: 'var(--danger-color)' }}>\r\n                                                <Trash2 size={16} />\r\n                                            </button>\r\n                                        </div>\r\n                                    </td>\r\n                                )}\r\n                            </tr>\r\n                        ))}\r\n                        {employees.length === 0 && (\r\n                            <tr>\r\n                                <td colSpan={userRole === 'admin' ? 4 : (userRole === 'viewer' ? 2 : 3)} style={{ textAlign: 'center', padding: '2rem', color: 'var(--text-secondary)' }}>\r\n                                    –ù—è–º–∞ –≤—ä–≤–µ–¥–µ–Ω–∏ —Å–ª—É–∂–∏—Ç–µ–ª–∏.\r\n                                </td>\r\n                            </tr>\r\n                        )}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\User\\.gemini\\antigravity\\playground\\swift-intergalactic\\src\\pages\\Spreadsheet.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'motion' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":3,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":16,"suggestions":[{"messageId":"removeVar","data":{"varName":"motion"},"fix":{"range":[77,116],"text":""},"desc":"Remove unused variable 'motion'."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { motion } from 'framer-motion';\r\nimport { FileSpreadsheet } from 'lucide-react';\r\n\r\nexport const Spreadsheet = () => {\r\n    const { t } = useTranslation();\r\n\r\n    // The embed URL goes here. We'll set a placeholder for now until the user provides one.\r\n    // Example Google Sheets: 'https://docs.google.com/spreadsheets/d/e/.../pubhtml?widget=true&headers=false'\r\n    // Example Microsoft Excel: 'https://onedrive.live.com/embed?resid=...&authkey=...&em=2&wdAllowInteractivity=False&wdHideGridlines=True&wdHideHeaders=True&wdDownloadButton=True&wdInConfigurator=True'\r\n    const embedUrl = 'https://docs.google.com/spreadsheets/d/11Xe0dJCS4CUelDH41TvYLPfpcDD9Ws6MyE9KDdjZBe4/edit?rm=minimal';\r\n\r\n    return (\r\n        <div style={{ width: '100%', display: 'flex', flexDirection: 'column', height: 'calc(100vh - 80px)' }}>\r\n            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '1rem' }}>\r\n                <div>\r\n                    <h1 className=\"text-gradient\" style={{ fontSize: '1.5rem', marginBottom: '0' }}>{t('spreadsheet.title')}</h1>\r\n                    <p style={{ color: 'var(--text-secondary)', fontSize: '0.85rem' }}>{t('spreadsheet.subtitle')}</p>\r\n                </div>\r\n            </div>\r\n\r\n            <motion.div\r\n                className=\"glass-panel\"\r\n                style={{\r\n                    flex: 1,\r\n                    display: 'flex',\r\n                    flexDirection: 'column',\r\n                    overflow: 'hidden',\r\n                    padding: 0\r\n                }}\r\n                initial={{ opacity: 0, y: 20 }}\r\n                animate={{ opacity: 1, y: 0 }}\r\n                transition={{ duration: 0.4 }}\r\n            >\r\n                {embedUrl ? (\r\n                    <iframe\r\n                        src={embedUrl}\r\n                        width=\"100%\"\r\n                        height=\"100%\"\r\n                        frameBorder=\"0\"\r\n                        scrolling=\"yes\"\r\n                        style={{ background: 'white' }}\r\n                        title=\"Embedded Spreadsheet\"\r\n                    ></iframe>\r\n                ) : (\r\n                    <div style={{\r\n                        flex: 1,\r\n                        display: 'flex',\r\n                        flexDirection: 'column',\r\n                        alignItems: 'center',\r\n                        justifyContent: 'center',\r\n                        padding: '3rem',\r\n                        textAlign: 'center'\r\n                    }}>\r\n                        <FileSpreadsheet size={64} style={{ color: 'var(--text-muted)', marginBottom: '1rem' }} />\r\n                        <h2 style={{ fontSize: '1.5rem', marginBottom: '0.5rem', color: 'var(--text-primary)' }}>{t('spreadsheet.noLinkTitle')}</h2>\r\n                        <p style={{ color: 'var(--text-secondary)', maxWidth: '500px' }}>{t('spreadsheet.noLinkDesc')}</p>\r\n\r\n                        <div style={{ marginTop: '2rem', padding: '1.5rem', background: 'var(--bg-dark)', borderRadius: 'var(--radius-md)', border: '1px solid var(--panel-border)', textAlign: 'left', maxWidth: '600px', width: '100%' }}>\r\n                            <h3 style={{ fontSize: '1.1rem', marginBottom: '1rem', color: 'var(--text-primary)' }}>How to embed your spreadsheet:</h3>\r\n                            <ul style={{ color: 'var(--text-secondary)', paddingLeft: '1.5rem', display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>\r\n                                <li><strong>Google Sheets:</strong> Go to File {'>'} Share {'>'} Publish to web. Choose \"Embed\", click Publish, and copy the link inside `src=\"...\"`.</li>\r\n                                <li><strong>Excel Online:</strong> Go to File {'>'} Share {'>'} Embed. Copy the link in the `src=\"...\"` attribute of the embed code.</li>\r\n                            </ul>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </motion.div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\User\\.gemini\\antigravity\\playground\\swift-intergalactic\\src\\pages\\Transactions.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'motion' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":4,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":16,"suggestions":[{"messageId":"removeVar","data":{"varName":"motion"},"fix":{"range":[199,206],"text":""},"desc":"Remove unused variable 'motion'."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { useFinance } from '../context/FinanceContext';\r\nimport { Plus, Search, Trash2, ArrowUpRight, ArrowDownRight, Edit2 } from 'lucide-react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { useAuth } from '../context/AuthContext';\r\n\r\nconst formatCurrency = (amount) => {\r\n    return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'EUR' }).format(amount);\r\n};\r\n\r\nexport const Transactions = () => {\r\n    const { transactions, deleteTransaction, addTransaction, updateTransaction, categories } = useFinance();\r\n    const { userRole } = useAuth();\r\n    const { t } = useTranslation();\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [filterType, setFilterType] = useState('all');\r\n    const [dateFilterType, setDateFilterType] = useState('all'); // 'all', 'month', 'year'\r\n    const [dateFilterValue, setDateFilterValue] = useState('');\r\n    const [isModalOpen, setIsModalOpen] = useState(false);\r\n\r\n    const translateCategory = (cat) => t('categoryNames', { returnObjects: true })[cat] || cat;\r\n\r\n    // New/Edit Transaction Form State\r\n    const [editingId, setEditingId] = useState(null);\r\n    const [type, setType] = useState('expense');\r\n    const [amount, setAmount] = useState('');\r\n    const [category, setCategory] = useState(categories.expense[0]);\r\n    const [date, setDate] = useState(new Date().toISOString().split('T')[0]);\r\n    const [description, setDescription] = useState('');\r\n    const [paymentMethod, setPaymentMethod] = useState('cash');\r\n\r\n    const filteredTransactions = transactions.filter(txn => {\r\n        if (filterType !== 'all' && txn.type !== filterType) {\r\n            return false;\r\n        }\r\n\r\n        if (dateFilterType !== 'all' && dateFilterValue) {\r\n            if (dateFilterType === 'month' && !txn.date.startsWith(dateFilterValue)) return false;\r\n            if (dateFilterType === 'year' && !txn.date.startsWith(dateFilterValue)) return false;\r\n        }\r\n\r\n        const categoryMatchString = translateCategory(txn.category);\r\n\r\n        return txn.description.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n            categoryMatchString.toLowerCase().includes(searchTerm.toLowerCase());\r\n    });\r\n\r\n    const handleAddTransaction = (e) => {\r\n        e.preventDefault();\r\n        if (!amount) return;\r\n\r\n        const payload = {\r\n            type,\r\n            amount: parseFloat(amount),\r\n            category,\r\n            date,\r\n            description,\r\n            paymentMethod\r\n        };\r\n\r\n        if (editingId) {\r\n            updateTransaction(editingId, payload);\r\n        } else {\r\n            addTransaction(payload);\r\n        }\r\n\r\n        setIsModalOpen(false);\r\n        // Reset form\r\n        setEditingId(null);\r\n        setAmount('');\r\n        setDescription('');\r\n        setPaymentMethod('cash');\r\n    };\r\n\r\n    const openEditModal = (txn) => {\r\n        setEditingId(txn.id);\r\n        setType(txn.type);\r\n        setAmount(txn.amount);\r\n        setCategory(txn.category);\r\n        setDate(txn.date);\r\n        setDescription(txn.description);\r\n        setPaymentMethod(txn.paymentMethod || 'cash');\r\n        setIsModalOpen(true);\r\n    };\r\n\r\n    const handleOpenCreateModal = () => {\r\n        setEditingId(null);\r\n        setType('expense');\r\n        setAmount('');\r\n        setCategory(categories.expense[0] || '');\r\n        setDate(new Date().toISOString().split('T')[0]);\r\n        setDescription('');\r\n        setPaymentMethod('cash');\r\n        setIsModalOpen(true);\r\n    };\r\n\r\n    return (\r\n        <div className=\"animate-fade-in\" style={{ position: 'relative' }}>\r\n            <div className=\"page-header\">\r\n                <div>\r\n                    <h1 className=\"page-title\">{t('transactions.title')}</h1>\r\n                    <p className=\"page-subtitle\">{t('transactions.subtitle')}</p>\r\n                </div>\r\n                {userRole !== 'viewer' && (\r\n                    <button className=\"btn btn-primary\" onClick={handleOpenCreateModal}>\r\n                        <Plus size={18} />\r\n                        {t('transactions.addTransaction')}\r\n                    </button>\r\n                )}\r\n            </div>\r\n\r\n            <div className=\"glass-panel\" style={{ padding: '1.5rem', marginBottom: '2rem' }}>\r\n                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '1rem', marginBottom: '1rem' }}>\r\n                    <div style={{ position: 'relative', flex: '1 1 300px', display: 'flex', alignItems: 'center', background: 'var(--bg-dark)', border: '1px solid var(--panel-border)', borderRadius: 'var(--radius-sm)', transition: 'var(--transition)' }}>\r\n                        <Search size={18} style={{ position: 'absolute', left: '1rem', top: '50%', transform: 'translateY(-50%)', color: 'var(--text-muted)' }} />\r\n                        <input\r\n                            type=\"text\"\r\n                            placeholder={t('transactions.search')}\r\n                            value={searchTerm}\r\n                            onChange={(e) => setSearchTerm(e.target.value)}\r\n                            style={{\r\n                                width: '100%',\r\n                                padding: '0.75rem 1rem 0.75rem 2.5rem',\r\n                                background: 'rgba(15, 23, 42, 0.5)',\r\n                                border: '1px solid var(--panel-border)',\r\n                                borderRadius: 'var(--radius-sm)',\r\n                                color: 'var(--text-primary)',\r\n                                outline: 'none',\r\n                                fontSize: '1rem'\r\n                            }}\r\n                        />\r\n                    </div>\r\n                    <select\r\n                        value={filterType}\r\n                        onChange={(e) => setFilterType(e.target.value)}\r\n                        className=\"filter-select\"\r\n                        style={{ minWidth: '150px' }}\r\n                    >\r\n                        <option value=\"all\">{t('transactions.allTypes')}</option>\r\n                        <option value=\"income\">{t('transactions.income')}</option>\r\n                        <option value=\"expense\">{t('transactions.expense')}</option>\r\n                    </select>\r\n\r\n                    <select\r\n                        value={dateFilterType}\r\n                        onChange={(e) => {\r\n                            setDateFilterType(e.target.value);\r\n                            setDateFilterValue('');\r\n                        }}\r\n                        className=\"filter-select\"\r\n                        style={{ minWidth: '150px' }}\r\n                    >\r\n                        <option value=\"all\">{t('dashboard.filterAll')}</option>\r\n                        <option value=\"month\">{t('dashboard.filterMonth')}</option>\r\n                        <option value=\"year\">{t('dashboard.filterYear')}</option>\r\n                    </select>\r\n\r\n                    {dateFilterType === 'month' && (\r\n                        <input\r\n                            type=\"month\"\r\n                            className=\"filter-input\"\r\n                            value={dateFilterValue}\r\n                            onChange={(e) => setDateFilterValue(e.target.value)}\r\n                        />\r\n                    )}\r\n                    {dateFilterType === 'year' && (\r\n                        <input\r\n                            type=\"number\"\r\n                            className=\"filter-input\"\r\n                            placeholder=\"YYYY\"\r\n                            min=\"2000\"\r\n                            max=\"2100\"\r\n                            value={dateFilterValue}\r\n                            onChange={(e) => setDateFilterValue(e.target.value)}\r\n                            style={{ width: '120px' }}\r\n                        />\r\n                    )}\r\n                </div>\r\n\r\n\r\n                {/* Transactions Table */}\r\n                <div style={{ overflowX: 'auto' }}>\r\n                    <table style={{ width: '100%', borderCollapse: 'collapse', textAlign: 'left' }}>\r\n                        <thead>\r\n                            <tr style={{ borderBottom: '1px solid var(--panel-border)', color: 'var(--text-muted)', fontSize: '0.875rem' }}>\r\n                                <th style={{ padding: '1rem', fontWeight: 500 }}>{t('transactions.colTransaction')}</th>\r\n                                <th style={{ padding: '1rem', fontWeight: 500 }}>{t('transactions.colCategory')}</th>\r\n                                <th style={{ padding: '1rem', fontWeight: 500 }}>{t('transactions.paymentMethod')}</th>\r\n                                <th style={{ padding: '1rem', fontWeight: 500 }}>{t('transactions.colDate')}</th>\r\n                                <th style={{ padding: '1rem', fontWeight: 500, textAlign: 'right' }}>{t('transactions.colAmount')}</th>\r\n                                <th style={{ padding: '1rem', fontWeight: 500, textAlign: 'right' }}>{t('transactions.colActions')}</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                            {filteredTransactions.length === 0 ? (\r\n                                <tr>\r\n                                    <td colSpan=\"6\" style={{ padding: '2rem', textAlign: 'center', color: 'var(--text-muted)' }}>\r\n                                        {t('transactions.noTransactions')}\r\n                                    </td>\r\n                                </tr>\r\n                            ) : (\r\n                                filteredTransactions.map((txn) => (\r\n                                    <tr key={txn.id} style={{ borderBottom: '1px solid var(--panel-border)', transition: 'var(--transition)' }}>\r\n                                        <td style={{ padding: '1rem' }}>\r\n                                            <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem' }}>\r\n                                                <div style={{\r\n                                                    width: '40px', height: '40px', borderRadius: '50%', display: 'grid', placeItems: 'center',\r\n                                                    background: txn.type === 'income' ? 'var(--success-bg)' : 'var(--danger-bg)',\r\n                                                    color: txn.type === 'income' ? 'var(--success)' : 'var(--danger)'\r\n                                                }}>\r\n                                                    {txn.type === 'income' ? <ArrowUpRight size={20} /> : <ArrowDownRight size={20} />}\r\n                                                </div>\r\n                                                <div>\r\n                                                    <p style={{ fontWeight: 500, color: 'var(--text-primary)' }}>\r\n                                                        {txn.description.startsWith('Payment for Invoice:')\r\n                                                            ? txn.description.replace('Payment for Invoice:', t('invoices.paymentFor'))\r\n                                                            : txn.description}\r\n                                                    </p>\r\n                                                    <p style={{ fontSize: '0.875rem', color: 'var(--text-muted)' }}>{txn.id.substring(0, 8)}</p>\r\n                                                </div>\r\n                                            </div>\r\n                                        </td>\r\n                                        <td style={{ padding: '1rem' }}>\r\n                                            <span className={`badge ${txn.type === 'income' ? 'badge-income' : 'badge-expense'}`}>\r\n                                                {translateCategory(txn.category)}\r\n                                            </span>\r\n                                        </td>\r\n                                        <td style={{ padding: '1rem' }}>\r\n                                            <span style={{ fontSize: '0.875rem', padding: '0.25rem 0.5rem', borderRadius: '4px', background: 'rgba(255,255,255,0.05)', color: 'var(--text-secondary)' }}>\r\n                                                {txn.paymentMethod === 'bank' ? t('transactions.bank') : t('transactions.cash')}\r\n                                            </span>\r\n                                        </td>\r\n                                        <td style={{ padding: '1rem', color: 'var(--text-secondary)' }}>\r\n                                            {new Date(txn.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}\r\n                                        </td>\r\n                                        <td style={{ padding: '1rem', textAlign: 'right', fontWeight: 600, color: txn.type === 'income' ? 'var(--success)' : 'var(--text-primary)' }}>\r\n                                            {txn.type === 'income' ? '+' : '-'}{formatCurrency(txn.amount)}\r\n                                        </td>\r\n                                        {userRole !== 'viewer' && (\r\n                                            <td style={{ padding: '1rem', textAlign: 'right' }}>\r\n                                                <div style={{ display: 'flex', gap: '0.5rem', justifyContent: 'flex-end' }}>\r\n                                                    <button className=\"btn-icon\" onClick={() => openEditModal(txn)} title=\"Edit\">\r\n                                                        <Edit2 size={16} />\r\n                                                    </button>\r\n                                                    <button className=\"btn-icon\" onClick={() => deleteTransaction(txn.id)} title=\"Delete\">\r\n                                                        <Trash2 size={16} />\r\n                                                    </button>\r\n                                                </div>\r\n                                            </td>\r\n                                        )}\r\n                                    </tr>\r\n                                ))\r\n                            )}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Add Transaction Modal */}\r\n            <AnimatePresence>\r\n                {isModalOpen && (\r\n                    <motion.div\r\n                        initial={{ opacity: 0 }}\r\n                        animate={{ opacity: 1 }}\r\n                        exit={{ opacity: 0 }}\r\n                        style={{\r\n                            position: 'fixed', inset: 0, zIndex: 50, display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n                            background: 'rgba(2, 6, 23, 0.8)', backdropFilter: 'blur(4px)'\r\n                        }}\r\n                        onClick={() => setIsModalOpen(false)}\r\n                    >\r\n                        <motion.div\r\n                            initial={{ scale: 0.95, opacity: 0, y: 20 }}\r\n                            animate={{ scale: 1, opacity: 1, y: 0 }}\r\n                            exit={{ scale: 0.95, opacity: 0, y: 20 }}\r\n                            onClick={(e) => e.stopPropagation()}\r\n                            className=\"glass-panel\"\r\n                            style={{ width: '100%', maxWidth: '500px', padding: '2rem' }}\r\n                        >\r\n                            <h2 style={{ fontSize: '1.5rem', marginBottom: '1.5rem' }}>\r\n                                {editingId ? '–†–µ–¥–∞–∫—Ç–∏—Ä–∞–Ω–µ' : t('transactions.addNewTitle')}\r\n                            </h2>\r\n\r\n                            <div style={{ display: 'flex', gap: '1rem', marginBottom: '1.5rem' }}>\r\n                                <button\r\n                                    type=\"button\"\r\n                                    className={`btn ${type === 'expense' ? 'btn-primary' : ''}`}\r\n                                    style={{ flex: 1, background: type === 'expense' ? 'var(--danger)' : 'transparent', border: type !== 'expense' ? '1px solid var(--panel-border)' : 'none' }}\r\n                                    onClick={() => { setType('expense'); setCategory(categories.expense[0]); }}\r\n                                >\r\n                                    {t('transactions.expense')}\r\n                                </button>\r\n                                <button\r\n                                    type=\"button\"\r\n                                    className={`btn ${type === 'income' ? 'btn-primary' : ''}`}\r\n                                    style={{ flex: 1, background: type === 'income' ? 'var(--success)' : 'transparent', border: type !== 'income' ? '1px solid var(--panel-border)' : 'none' }}\r\n                                    onClick={() => { setType('income'); setCategory(categories.income[0]); }}\r\n                                >\r\n                                    {t('transactions.income')}\r\n                                </button>\r\n                            </div>\r\n\r\n                            <form onSubmit={handleAddTransaction}>\r\n                                <div className=\"input-group\">\r\n                                    <label>{t('transactions.colAmount')} (‚Ç¨)</label>\r\n                                    <input type=\"number\" step=\"0.01\" min=\"0\" required value={amount} onChange={(e) => setAmount(e.target.value)} placeholder=\"0.00\" />\r\n                                </div>\r\n\r\n                                <div className=\"input-group\">\r\n                                    <label>{t('transactions.description')}</label>\r\n                                    <input type=\"text\" value={description} onChange={(e) => setDescription(e.target.value)} placeholder={t('transactions.whatFor')} />\r\n                                </div>\r\n\r\n                                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem' }}>\r\n                                    <div className=\"input-group\">\r\n                                        <label>{t('transactions.colCategory')}</label>\r\n                                        <select value={category} onChange={(e) => setCategory(e.target.value)}>\r\n                                            {categories[type].map(cat => (\r\n                                                <option key={cat} value={cat}>\r\n                                                    {translateCategory(cat)}\r\n                                                </option>\r\n                                            ))}\r\n                                        </select>\r\n                                    </div>\r\n                                    <div className=\"input-group\">\r\n                                        <label>{t('transactions.colDate')}</label>\r\n                                        <input type=\"date\" required value={date} onChange={(e) => setDate(e.target.value)} />\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"input-group\" style={{ marginTop: '0.5rem' }}>\r\n                                    <label>{t('transactions.paymentMethod')}</label>\r\n                                    <div style={{ display: 'flex', gap: '1rem' }}>\r\n                                        <label style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', cursor: 'pointer', padding: '0.75rem', border: '1px solid', borderRadius: 'var(--radius-sm)', flex: 1, background: paymentMethod === 'cash' ? 'var(--primary-glow)' : 'transparent', borderColor: paymentMethod === 'cash' ? 'var(--primary)' : 'var(--panel-border)', transition: 'var(--transition)' }}>\r\n                                            <input type=\"radio\" name=\"paymentMethod\" value=\"cash\" checked={paymentMethod === 'cash'} onChange={(e) => setPaymentMethod(e.target.value)} style={{ display: 'none' }} />\r\n                                            <span style={{ color: paymentMethod === 'cash' ? 'var(--primary)' : 'var(--text-primary)', transition: 'var(--transition)' }}>{t('transactions.cash')}</span>\r\n                                        </label>\r\n                                        <label style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', cursor: 'pointer', padding: '0.75rem', border: '1px solid', borderRadius: 'var(--radius-sm)', flex: 1, background: paymentMethod === 'bank' ? 'var(--primary-glow)' : 'transparent', borderColor: paymentMethod === 'bank' ? 'var(--primary)' : 'var(--panel-border)', transition: 'var(--transition)' }}>\r\n                                            <input type=\"radio\" name=\"paymentMethod\" value=\"bank\" checked={paymentMethod === 'bank'} onChange={(e) => setPaymentMethod(e.target.value)} style={{ display: 'none' }} />\r\n                                            <span style={{ color: paymentMethod === 'bank' ? 'var(--primary)' : 'var(--text-primary)', transition: 'var(--transition)' }}>{t('transactions.bank')}</span>\r\n                                        </label>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div style={{ display: 'flex', justifyContent: 'flex-end', gap: '1rem', marginTop: '2rem' }}>\r\n                                    <button type=\"button\" className=\"btn btn-outline\" onClick={() => setIsModalOpen(false)}>{t('transactions.cancel')}</button>\r\n                                    <button type=\"submit\" className=\"btn btn-primary\">{t('transactions.save')}</button>\r\n                                </div>\r\n                            </form>\r\n                        </motion.div>\r\n                    </motion.div>\r\n                )}\r\n            </AnimatePresence>\r\n        </div >\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\User\\.gemini\\antigravity\\playground\\swift-intergalactic\\test-firebase.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'process' is not defined.","line":31,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":31,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'process' is not defined.","line":34,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":34,"endColumn":16}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { initializeApp } from \"firebase/app\";\r\nimport { getFirestore, collection, addDoc, getDocs } from \"firebase/firestore\";\r\n\r\nconst firebaseConfig = {\r\n    apiKey: \"AIzaSyDp7tefCAVKrZPA1UWpnAwIWD4SCt67j6o\",\r\n    authDomain: \"financialtracker-653a3.firebaseapp.com\",\r\n    projectId: \"financialtracker-653a3\",\r\n    storageBucket: \"financialtracker-653a3.firebasestorage.app\",\r\n    messagingSenderId: \"892807839835\",\r\n    appId: \"1:892807839835:web:ad7293d4743c068e6a3f7e\"\r\n};\r\n\r\nconst app = initializeApp(firebaseConfig);\r\nconst db = getFirestore(app);\r\n\r\nasync function test() {\r\n    try {\r\n        console.log(\"Adding doc...\");\r\n        const docRef = await addDoc(collection(db, \"transactions\"), {\r\n            amount: 999,\r\n            category: \"Test\",\r\n            date: new Date().toISOString().split('T')[0],\r\n            description: \"Node.js Test\",\r\n            type: \"income\"\r\n        });\r\n        console.log(\"Added doc with ID:\", docRef.id);\r\n\r\n        console.log(\"Fetching docs...\");\r\n        const snapshot = await getDocs(collection(db, \"transactions\"));\r\n        console.log(\"Total docs:\", snapshot.size);\r\n        process.exit(0);\r\n    } catch (e) {\r\n        console.error(\"Error:\", e);\r\n        process.exit(1);\r\n    }\r\n}\r\n\r\ntest();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\User\\.gemini\\antigravity\\playground\\swift-intergalactic\\test-ocr.js","messages":[{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\:.","line":21,"column":122,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":21,"endColumn":123,"suggestions":[{"messageId":"removeEscape","fix":{"range":[798,799],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[798,798],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\..","line":21,"column":147,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":21,"endColumn":148,"suggestions":[{"messageId":"removeEscape","fix":{"range":[823,824],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[823,823],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\,.","line":21,"column":149,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":21,"endColumn":150,"suggestions":[{"messageId":"removeEscape","fix":{"range":[825,826],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[825,825],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\..","line":25,"column":62,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":25,"endColumn":63,"suggestions":[{"messageId":"removeEscape","fix":{"range":[1070,1071],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[1070,1070],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\,.","line":25,"column":64,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":25,"endColumn":65,"suggestions":[{"messageId":"removeEscape","fix":{"range":[1072,1073],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[1072,1072],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\..","line":34,"column":112,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":34,"endColumn":113,"suggestions":[{"messageId":"removeEscape","fix":{"range":[1561,1562],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[1561,1561],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\,.","line":34,"column":114,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":34,"endColumn":115,"suggestions":[{"messageId":"removeEscape","fix":{"range":[1563,1564],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[1563,1563],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":34,"column":118,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":34,"endColumn":119,"suggestions":[{"messageId":"removeEscape","fix":{"range":[1567,1568],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[1567,1567],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":34,"column":120,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":34,"endColumn":121,"suggestions":[{"messageId":"removeEscape","fix":{"range":[1569,1570],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[1569,1569],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\:.","line":41,"column":55,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":41,"endColumn":56,"suggestions":[{"messageId":"removeEscape","fix":{"range":[1968,1969],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[1968,1968],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\..","line":41,"column":57,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":41,"endColumn":58,"suggestions":[{"messageId":"removeEscape","fix":{"range":[1970,1971],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[1970,1970],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":41,"column":69,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":41,"endColumn":70,"suggestions":[{"messageId":"removeEscape","fix":{"range":[1982,1983],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[1982,1982],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\..","line":41,"column":73,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":41,"endColumn":74,"suggestions":[{"messageId":"removeEscape","fix":{"range":[1986,1987],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[1986,1986],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":41,"column":85,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":41,"endColumn":86,"suggestions":[{"messageId":"removeEscape","fix":{"range":[1998,1999],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[1998,1998],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\..","line":41,"column":89,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":41,"endColumn":90,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2002,2003],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2002,2002],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":41,"column":127,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":41,"endColumn":128,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2040,2041],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2040,2040],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\..","line":41,"column":131,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":41,"endColumn":132,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2044,2045],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2044,2044],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":41,"column":142,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":41,"endColumn":143,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2055,2056],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2055,2055],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\..","line":41,"column":146,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":41,"endColumn":147,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2059,2060],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2059,2059],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]}],"suppressedMessages":[],"errorCount":19,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import Tesseract from 'tesseract.js';\r\n\r\nasync function testOCR(imagePath) {\r\n    console.log(\"Starting OCR on:\", imagePath);\r\n    try {\r\n        const worker = await Tesseract.createWorker('bul+eng');\r\n        await worker.setParameters({\r\n            tessedit_pageseg_mode: Tesseract.PSM.SPARSE_TEXT,\r\n        });\r\n\r\n        const result = await worker.recognize(imagePath);\r\n        const text = result.data.text;\r\n        await worker.terminate();\r\n\r\n        console.log(\"=== EXTACTED TEXT ===\");\r\n        console.log(text);\r\n        console.log(\"=====================\");\r\n\r\n        // 1. Total Amount: Try strict match, then fallback\r\n        let extractedAmount = null;\r\n        const amountStrMatch = text.match(/(?:–æ–±—â–∞ —Å—É–º–∞|—Å—É–º–∞ –∑–∞ –ø–ª–∞—â–∞–Ω–µ|—Å—É–º–∞|total|–ø–ª–∞—â–∞–Ω–µ|—Å—Ç–æ–π–Ω–æ—Å—Ç|–≤—Å–∏—á–∫–æ|–¥–¥—Å|–æ—Å–Ω–æ–≤–∞)[\\s\\:A-Za-z–ê-–Ø–∞-—è]*([\\d\\s]+[\\.\\,]\\d{2})/i);\r\n        if (amountStrMatch && amountStrMatch[1]) {\r\n            extractedAmount = parseFloat(amountStrMatch[1].replace(/\\s/g, '').replace(',', '.'));\r\n        } else {\r\n            const allNumbers = [...text.matchAll(/\\b(\\d{1,6}[\\.\\,]\\d{2})\\b/g)];\r\n            if (allNumbers.length > 0) {\r\n                const parsedNums = allNumbers.map(m => parseFloat(m[1].replace(',', '.'))).filter(n => !isNaN(n));\r\n                if (parsedNums.length > 0) extractedAmount = Math.max(...parsedNums);\r\n            }\r\n        }\r\n        console.log(\"Extracted Amount:\", extractedAmount);\r\n\r\n        // 2. Client Name\r\n        const clientMatch = text.match(/(?:–ø–æ–ª—É—á–∞—Ç–µ–ª|–∫–ª–∏–µ–Ω—Ç|–ø–æ–ª—É—á–∞—Ç–µ–ª:|–∫–ª–∏–µ–Ω—Ç:|–∫—É–ø—É–≤–∞—á)[\\s]+([A-Za-z–ê-–Ø–∞-—è0-9\\s\\.\\,\\-\\\"\\']+)/i) || text.match(/([–ê-–Ø][–ê-–Ø–∞-—è]+(?:\\s[–ê-–Ø–∞-—è]+)?\\s+(?:–û–û–î|–ï–û–û–î|–ê–î|–ï–ê–î|–ï–¢))/i);\r\n        if (clientMatch && clientMatch[1]) {\r\n            const cleanedClient = clientMatch[1].replace(/(?:–ï–ò–ö|–î–î–°|BG\\d+|–≥—Ä\\.|—É–ª\\.).*/i, '').trim();\r\n            console.log(\"Client Match:\", cleanedClient.substring(0, 50));\r\n        }\r\n\r\n        // 3. Date\r\n        const dateMatch = text.match(/(?:–¥–∞—Ç–∞|date)[\\s\\:\\.]*(\\d{2})[\\/\\-\\.]?(\\d{2})[\\/\\-\\.]?(\\d{4})/i) || text.match(/(\\d{2})[\\/\\-\\.](\\d{2})[\\/\\-\\.](\\d{2,4})/);\r\n        if (dateMatch) {\r\n            const year = dateMatch[3].length === 2 ? `20${dateMatch[3]}` : dateMatch[3];\r\n            console.log(\"Date Match:\", `${year}-${dateMatch[2]}-${dateMatch[1]}`);\r\n        }\r\n\r\n    } catch (err) {\r\n        console.error(\"Error:\", err);\r\n    }\r\n}\r\n\r\ntestOCR('c:\\\\Users\\\\User\\\\.gemini\\\\antigravity\\\\brain\\\\548a49b2-0058-4153-b627-993a9e39596a\\\\media__1771999267322.png');\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\User\\.gemini\\antigravity\\playground\\swift-intergalactic\\vite.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]